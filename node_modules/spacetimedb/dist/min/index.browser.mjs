import{fromByteArray as e}from"base64-js";var t=class e{__time_duration_micros__;static MICROS_PER_MILLIS=1000n;static getAlgebraicType(){return U.Product({elements:[{name:"__time_duration_micros__",algebraicType:U.I64}]})}static isTimeDuration(e){if("Product"!==e.tag)return!1;const t=e.value.elements;if(1!==t.length)return!1;const r=t[0];return"__time_duration_micros__"===r.name&&"I64"===r.algebraicType.tag}get micros(){return this.__time_duration_micros__}get millis(){return Number(this.micros/e.MICROS_PER_MILLIS)}constructor(e){this.__time_duration_micros__=e}static fromMillis(t){return new e(BigInt(t)*e.MICROS_PER_MILLIS)}toString(){const e=this.micros,t=e<0?-e:e;return`${e<0?"-":"+"}${t/1000000n}.${String(t%1000000n).padStart(6,"0")}`}},r=class e{__timestamp_micros_since_unix_epoch__;static MICROS_PER_MILLIS=1000n;get microsSinceUnixEpoch(){return this.__timestamp_micros_since_unix_epoch__}constructor(e){this.__timestamp_micros_since_unix_epoch__=e}static getAlgebraicType(){return U.Product({elements:[{name:"__timestamp_micros_since_unix_epoch__",algebraicType:U.I64}]})}static isTimestamp(e){if("Product"!==e.tag)return!1;const t=e.value.elements;if(1!==t.length)return!1;const r=t[0];return"__timestamp_micros_since_unix_epoch__"===r.name&&"I64"===r.algebraicType.tag}static UNIX_EPOCH=new e(0n);static now(){return e.fromDate(new Date)}toMillis(){return this.microsSinceUnixEpoch/1000n}static fromDate(t){const r=t.getTime(),n=BigInt(r)*e.MICROS_PER_MILLIS;return new e(n)}toDate(){const t=this.__timestamp_micros_since_unix_epoch__/e.MICROS_PER_MILLIS;if(t>BigInt(Number.MAX_SAFE_INTEGER)||t<BigInt(Number.MIN_SAFE_INTEGER))throw new RangeError("Timestamp is outside of the representable range of JS's Date");return new Date(Number(t))}since(e){return new t(this.__timestamp_micros_since_unix_epoch__-e.__timestamp_micros_since_unix_epoch__)}},n=class e{__uuid__;static NIL=new e(0n);static MAX_UUID_BIGINT=0xffffffffffffffffffffffffffffffffn;static MAX=new e(e.MAX_UUID_BIGINT);constructor(t){if(t<0n||t>e.MAX_UUID_BIGINT)throw new Error("Invalid UUID: must be between 0 and `MAX_UUID_BIGINT`");this.__uuid__=t}static fromRandomBytesV4(t){if(16!==t.length)throw new Error("UUID v4 requires 16 bytes");const r=new Uint8Array(t);return r[6]=15&r[6]|64,r[8]=63&r[8]|128,new e(e.bytesToBigInt(r))}static fromCounterV7(t,r,n){if(4!==n.length)throw new Error("`fromCounterV7` requires `randomBytes.length == 4`");if(t.value<0)throw new Error("`fromCounterV7` uuid `counter` must be non-negative");if(r.__timestamp_micros_since_unix_epoch__<0)throw new Error("`fromCounterV7` `timestamp` before unix epoch");const i=t.value;t.value=i+1&2147483647;const s=0xffffffffffffn&r.toMillis(),a=new Uint8Array(16);return a[0]=Number(s>>40n&0xffn),a[1]=Number(s>>32n&0xffn),a[2]=Number(s>>24n&0xffn),a[3]=Number(s>>16n&0xffn),a[4]=Number(s>>8n&0xffn),a[5]=Number(0xffn&s),a[7]=i>>>23&255,a[9]=i>>>15&255,a[10]=i>>>7&255,a[11]=(127&i)<<1&255,a[12]|=127&n[0],a[13]=n[1],a[14]=n[2],a[15]=n[3],a[6]=15&a[6]|112,a[8]=63&a[8]|128,new e(e.bytesToBigInt(a))}static parse(t){const r=t.replace(/-/g,"");if(32!==r.length)throw new Error("Invalid hex UUID");let n=0n;for(let e=0;e<32;e+=2)n=n<<8n|BigInt(parseInt(r.slice(e,e+2),16));return new e(n)}toString(){const t=[...e.bigIntToBytes(this.__uuid__)].map(e=>e.toString(16).padStart(2,"0")).join("");return t.slice(0,8)+"-"+t.slice(8,12)+"-"+t.slice(12,16)+"-"+t.slice(16,20)+"-"+t.slice(20)}asBigInt(){return this.__uuid__}toBytes(){return e.bigIntToBytes(this.__uuid__)}static bytesToBigInt(e){let t=0n;for(const r of e)t=t<<8n|BigInt(r);return t}static bigIntToBytes(e){const t=new Uint8Array(16);for(let r=15;r>=0;r--)t[r]=Number(0xffn&e),e>>=8n;return t}getVersion(){const t=this.toBytes()[6]>>4&15;switch(t){case 4:return"V4";case 7:return"V7";default:if(this==e.NIL)return"Nil";if(this==e.MAX)return"Max";throw new Error(`Unsupported UUID version: ${t}`)}}getCounter(){const e=this.toBytes();return e[7]<<23|e[9]<<15|e[10]<<7|e[11]>>>1}compareTo(e){return this.__uuid__<e.__uuid__?-1:this.__uuid__>e.__uuid__?1:0}static getAlgebraicType(){return U.Product({elements:[{name:"__uuid__",algebraicType:U.U128}]})}},i=class{#e;#t;#r=0;constructor(e){this.#e=new Uint8Array(e),this.#t=new DataView(this.#e.buffer)}#n(e){const t=this.#r+e+1;if(t<=this.#e.length)return;let r=2*this.#e.length;r<t&&(r=t);const n=new Uint8Array(r);n.set(this.#e),this.#e=n,this.#t=new DataView(this.#e.buffer)}toBase64(){return e(this.#e.subarray(0,this.#r))}getBuffer(){return this.#e.slice(0,this.#r)}get offset(){return this.#r}writeUInt8Array(e){const t=e.length;this.#n(4+t),this.writeU32(t),this.#e.set(e,this.#r),this.#r+=e.length}writeBool(e){this.#n(1),this.#t.setUint8(this.#r,e?1:0),this.#r+=1}writeByte(e){this.#n(1),this.#t.setUint8(this.#r,e),this.#r+=1}writeI8(e){this.#n(1),this.#t.setInt8(this.#r,e),this.#r+=1}writeU8(e){this.#n(1),this.#t.setUint8(this.#r,e),this.#r+=1}writeI16(e){this.#n(2),this.#t.setInt16(this.#r,e,!0),this.#r+=2}writeU16(e){this.#n(2),this.#t.setUint16(this.#r,e,!0),this.#r+=2}writeI32(e){this.#n(4),this.#t.setInt32(this.#r,e,!0),this.#r+=4}writeU32(e){this.#n(4),this.#t.setUint32(this.#r,e,!0),this.#r+=4}writeI64(e){this.#n(8),this.#t.setBigInt64(this.#r,e,!0),this.#r+=8}writeU64(e){this.#n(8),this.#t.setBigUint64(this.#r,e,!0),this.#r+=8}writeU128(e){this.#n(16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);this.#t.setBigUint64(this.#r,t,!0),this.#t.setBigUint64(this.#r+8,r,!0),this.#r+=16}writeI128(e){this.#n(16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);this.#t.setBigInt64(this.#r,t,!0),this.#t.setBigInt64(this.#r+8,r,!0),this.#r+=16}writeU256(e){this.#n(32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64)&t,i=e>>BigInt(128)&t,s=e>>BigInt(192);this.#t.setBigUint64(this.#r+0,r,!0),this.#t.setBigUint64(this.#r+8,n,!0),this.#t.setBigUint64(this.#r+16,i,!0),this.#t.setBigUint64(this.#r+24,s,!0),this.#r+=32}writeI256(e){this.#n(32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64)&t,i=e>>BigInt(128)&t,s=e>>BigInt(192);this.#t.setBigUint64(this.#r+0,r,!0),this.#t.setBigUint64(this.#r+8,n,!0),this.#t.setBigUint64(this.#r+16,i,!0),this.#t.setBigInt64(this.#r+24,s,!0),this.#r+=32}writeF32(e){this.#n(4),this.#t.setFloat32(this.#r,e,!0),this.#r+=4}writeF64(e){this.#n(8),this.#t.setFloat64(this.#r,e,!0),this.#r+=8}writeString(e){const t=(new TextEncoder).encode(e);this.writeU32(t.length),this.#n(t.length),this.#e.set(t,this.#r),this.#r+=t.length}},s=class{#t;#r=0;constructor(e){this.#t=new DataView(e.buffer,e.byteOffset,e.byteLength),this.#r=0}get offset(){return this.#r}get remaining(){return this.#t.byteLength-this.#r}#i(e){if(this.#r+e>this.#t.byteLength)throw new RangeError(`Tried to read ${e} byte(s) at relative offset ${this.#r}, but only ${this.remaining} byte(s) remain`)}readUInt8Array(){const e=this.readU32();return this.#i(e),this.readBytes(e)}readBool(){const e=this.#t.getUint8(this.#r);return this.#r+=1,0!==e}readByte(){const e=this.#t.getUint8(this.#r);return this.#r+=1,e}readBytes(e){const t=new Uint8Array(this.#t.buffer,this.#t.byteOffset+this.#r,e);return this.#r+=e,t}readI8(){const e=this.#t.getInt8(this.#r);return this.#r+=1,e}readU8(){return this.readByte()}readI16(){const e=this.#t.getInt16(this.#r,!0);return this.#r+=2,e}readU16(){const e=this.#t.getUint16(this.#r,!0);return this.#r+=2,e}readI32(){const e=this.#t.getInt32(this.#r,!0);return this.#r+=4,e}readU32(){const e=this.#t.getUint32(this.#r,!0);return this.#r+=4,e}readI64(){const e=this.#t.getBigInt64(this.#r,!0);return this.#r+=8,e}readU64(){const e=this.#t.getBigUint64(this.#r,!0);return this.#r+=8,e}readU128(){const e=this.#t.getBigUint64(this.#r,!0),t=this.#t.getBigUint64(this.#r+8,!0);return this.#r+=16,(t<<BigInt(64))+e}readI128(){const e=this.#t.getBigUint64(this.#r,!0),t=this.#t.getBigInt64(this.#r+8,!0);return this.#r+=16,(t<<BigInt(64))+e}readU256(){const e=this.#t.getBigUint64(this.#r,!0),t=this.#t.getBigUint64(this.#r+8,!0),r=this.#t.getBigUint64(this.#r+16,!0),n=this.#t.getBigUint64(this.#r+24,!0);return this.#r+=32,(n<<BigInt(192))+(r<<BigInt(128))+(t<<BigInt(64))+e}readI256(){const e=this.#t.getBigUint64(this.#r,!0),t=this.#t.getBigUint64(this.#r+8,!0),r=this.#t.getBigUint64(this.#r+16,!0),n=this.#t.getBigInt64(this.#r+24,!0);return this.#r+=32,(n<<BigInt(192))+(r<<BigInt(128))+(t<<BigInt(64))+e}readF32(){const e=this.#t.getFloat32(this.#r,!0);return this.#r+=4,e}readF64(){const e=this.#t.getFloat64(this.#r,!0);return this.#r+=8,e}readString(){const e=this.readUInt8Array();return new TextDecoder("utf-8").decode(e)}};function a(e){const t=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace("-","").replace("_",""));return t.charAt(0).toUpperCase()+t.slice(1)}function u(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const i of r)if(!n.includes(i)||!u(e[i],t[i]))return!1;return!0}function o(e){return Array.prototype.map.call(e.reverse(),e=>("00"+e.toString(16)).slice(-2)).join("")}function c(e){if(16!=e.length)throw new Error(`Uint8Array is not 16 bytes long: ${e}`);return new s(e).readU128()}function l(e){if(32!=e.length)throw new Error(`Uint8Array is not 32 bytes long: [${e}]`);return new s(e).readU256()}function d(e){e.startsWith("0x")&&(e=e.slice(2));const t=e.match(/.{1,2}/g)||[];return Uint8Array.from(t.map(e=>parseInt(e,16))).reverse()}function h(e){return c(d(e))}function m(e){return l(d(e))}function p(e){const t=new i(16);return t.writeU128(e),t.getBuffer()}function f(e){return o(p(e))}function y(e){const t=new i(32);return t.writeU256(e),t.getBuffer()}function w(e){return o(y(e))}function g(e){return e.replace(/[-_]+/g,"_").replace(/_([a-zA-Z0-9])/g,(e,t)=>t.toUpperCase())}function b(e){return e.replace(/([A-Z])/g,"_$1").replace(/[-\s]+/g,"_").toLowerCase()}function I(e,t){for(;"Ref"===t.tag;)t=e.types[t.value];if("Product"===t.tag){let r=0;for(const{algebraicType:n}of t.value.elements)r+=I(e,n);return r}if("Sum"===t.tag){let r=1/0;for(const{algebraicType:n}of t.value.variants){const t=I(e,n);t<r&&(r=t)}return r===1/0&&(r=0),4+r}return"Array"==t.tag?4+4*I(e,t.value):{String:8,Sum:1,Bool:1,I8:1,U8:1,I16:2,U16:2,I32:4,U32:4,F32:4,I64:8,U64:8,F64:8,I128:16,U128:16,I256:32,U256:32}[t.tag]}function v(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,"typeBuilder"in t?t.typeBuilder:t]))}var _=class e{__identity__;constructor(e){this.__identity__="string"==typeof e?m(e):e}static getAlgebraicType(){return U.Product({elements:[{name:"__identity__",algebraicType:U.U256}]})}isEqual(e){return this.toHexString()===e.toHexString()}equals(e){return this.isEqual(e)}toHexString(){return w(this.__identity__)}toUint8Array(){return y(this.__identity__)}static fromString(t){return new e(t)}static zero(){return new e(0n)}toString(){return this.toHexString()}},B={},U={Ref:e=>({tag:"Ref",value:e}),Sum:e=>({tag:"Sum",value:e}),Product:e=>({tag:"Product",value:e}),Array:e=>({tag:"Array",value:e}),String:{tag:"String"},Bool:{tag:"Bool"},I8:{tag:"I8"},U8:{tag:"U8"},I16:{tag:"I16"},U16:{tag:"U16"},I32:{tag:"I32"},U32:{tag:"U32"},I64:{tag:"I64"},U64:{tag:"U64"},I128:{tag:"I128"},U128:{tag:"U128"},I256:{tag:"I256"},U256:{tag:"U256"},F32:{tag:"F32"},F64:{tag:"F64"},serializeValue(e,t,r,n){if("Ref"===t.tag){if(!n)throw new Error("cannot serialize refs without a typespace");for(;"Ref"===t.tag;)t=n.types[t.value]}switch(t.tag){case"Product":x.serializeValue(e,t.value,r,n);break;case"Sum":T.serializeValue(e,t.value,r,n);break;case"Array":if("U8"===t.value.tag)e.writeUInt8Array(r);else{const i=t.value;e.writeU32(r.length);for(const t of r)U.serializeValue(e,i,t,n)}break;case"Bool":e.writeBool(r);break;case"I8":e.writeI8(r);break;case"U8":e.writeU8(r);break;case"I16":e.writeI16(r);break;case"U16":e.writeU16(r);break;case"I32":e.writeI32(r);break;case"U32":e.writeU32(r);break;case"I64":e.writeI64(r);break;case"U64":e.writeU64(r);break;case"I128":e.writeI128(r);break;case"U128":e.writeU128(r);break;case"I256":e.writeI256(r);break;case"U256":e.writeU256(r);break;case"F32":e.writeF32(r);break;case"F64":e.writeF64(r);break;case"String":e.writeString(r)}},deserializeValue:function(e,t,r){if("Ref"===t.tag){if(!r)throw new Error("cannot deserialize refs without a typespace");for(;"Ref"===t.tag;)t=r.types[t.value]}switch(t.tag){case"Product":return x.deserializeValue(e,t.value,r);case"Sum":return T.deserializeValue(e,t.value,r);case"Array":if("U8"===t.value.tag)return e.readUInt8Array();{const n=t.value,i=e.readU32(),s=[];for(let t=0;t<i;t++)s.push(U.deserializeValue(e,n,r));return s}case"Bool":return e.readBool();case"I8":return e.readI8();case"U8":return e.readU8();case"I16":return e.readI16();case"U16":return e.readU16();case"I32":return e.readI32();case"U32":return e.readU32();case"I64":return e.readI64();case"U64":return e.readU64();case"I128":return e.readI128();case"U128":return e.readU128();case"I256":return e.readI256();case"U256":return e.readU256();case"F32":return e.readF32();case"F64":return e.readF64();case"String":return e.readString()}},intoMapKey:function(e,t){switch(e.tag){case"U8":case"U16":case"U32":case"U64":case"U128":case"U256":case"I8":case"I16":case"I32":case"I64":case"I128":case"I256":case"F32":case"F64":case"String":case"Bool":return t;case"Product":return x.intoMapKey(e.value,t);default:{const r=new i(10);return U.serializeValue(r,e,t),r.toBase64()}}}},x={serializeValue(e,t,r,n){for(const i of t.elements)U.serializeValue(e,i.algebraicType,r[i.name],n)},deserializeValue(e,i,s){const a={};if(1===i.elements.length){if("__time_duration_micros__"===i.elements[0].name)return new t(e.readI64());if("__timestamp_micros_since_unix_epoch__"===i.elements[0].name)return new r(e.readI64());if("__identity__"===i.elements[0].name)return new _(e.readU256());if("__connection_id__"===i.elements[0].name)return new M(e.readU128());if("__uuid__"===i.elements[0].name)return new n(e.readU128())}for(const t of i.elements)a[t.name]=U.deserializeValue(e,t.algebraicType,s);return a},intoMapKey(e,t){if(1===e.elements.length){if("__time_duration_micros__"===e.elements[0].name)return t.__time_duration_micros__;if("__timestamp_micros_since_unix_epoch__"===e.elements[0].name)return t.__timestamp_micros_since_unix_epoch__;if("__identity__"===e.elements[0].name)return t.__identity__;if("__connection_id__"===e.elements[0].name)return t.__connection_id__;if("__uuid__"===e.elements[0].name)return t.__uuid__}const r=new i(10);return U.serializeValue(r,U.Product(e),t),r.toBase64()}},T={serializeValue:function(e,t,r,n){if(2==t.variants.length&&"some"===t.variants[0].name&&"none"===t.variants[1].name)null!=r?(e.writeByte(0),U.serializeValue(e,t.variants[0].algebraicType,r,n)):e.writeByte(1);else if(2==t.variants.length&&"ok"===t.variants[0].name&&"err"===t.variants[1].name){let i,s,a;if("ok"in r?(i="ok",s=r.ok,a=0):(i="err",s=r.err,a=1),a<0)throw`Result serialization error: variant '${i}' not found in ${JSON.stringify(t)}`;e.writeU8(a),U.serializeValue(e,t.variants[a].algebraicType,s,n)}else{const i=r.tag,s=t.variants.findIndex(e=>e.name===i);if(s<0)throw`Can't serialize a sum type, couldn't find ${r.tag} tag ${JSON.stringify(r)} in variants ${JSON.stringify(t)}`;e.writeU8(s),U.serializeValue(e,t.variants[s].algebraicType,r.value,n)}},deserializeValue:function(e,t,r){const n=e.readU8();if(2==t.variants.length&&"some"===t.variants[0].name&&"none"===t.variants[1].name){if(0===n)return U.deserializeValue(e,t.variants[0].algebraicType,r);if(1===n)return;throw`Can't deserialize an option type, couldn't find ${n} tag`}if(2==t.variants.length&&"ok"===t.variants[0].name&&"err"===t.variants[1].name){if(0===n){return{ok:U.deserializeValue(e,t.variants[0].algebraicType,r)}}if(1===n){return{err:U.deserializeValue(e,t.variants[1].algebraicType,r)}}throw`Can't deserialize a result type, couldn't find ${n} tag`}{const i=t.variants[n],s=U.deserializeValue(e,i.algebraicType,r);return{tag:i.name,value:s}}}},M=class e{__connection_id__;constructor(e){this.__connection_id__=e}static getAlgebraicType(){return U.Product({elements:[{name:"__connection_id__",algebraicType:U.U128}]})}isZero(){return this.__connection_id__===BigInt(0)}static nullIfZero(e){return e.isZero()?null:e}static random(){function t(){return Math.floor(255*Math.random())}let r=BigInt(0);for(let e=0;e<16;e++)r=r<<BigInt(8)|BigInt(t());return new e(r)}isEqual(e){return this.__connection_id__==e.__connection_id__}equals(e){return this.isEqual(e)}toHexString(){return f(this.__connection_id__)}toUint8Array(){return p(this.__connection_id__)}static fromString(t){return new e(h(t))}static fromStringOrNull(t){const r=e.fromString(t);return r.isZero()?null:r}};function S(e,t){const r=new s(t);return e.deserialize(r)}var q={interval:e=>A(e),time:e=>P(e),getAlgebraicType:()=>U.Sum({variants:[{name:"Interval",algebraicType:t.getAlgebraicType()},{name:"Time",algebraicType:r.getAlgebraicType()}]}),isScheduleAt(e){if("Sum"!==e.tag)return!1;const n=e.value.variants;if(2!==n.length)return!1;const i=n.find(e=>"Interval"===e.name),s=n.find(e=>"Time"===e.name);return!(!i||!s)&&(t.isTimeDuration(i.algebraicType)&&r.isTimestamp(s.algebraicType))}},A=e=>({tag:"Interval",value:new t(e)}),P=e=>({tag:"Time",value:new r(e)}),F=q,k={getAlgebraicType:e=>U.Sum({variants:[{name:"some",algebraicType:e},{name:"none",algebraicType:U.Product({elements:[]})}]})},O={getAlgebraicType:(e,t)=>U.Sum({variants:[{name:"ok",algebraicType:e},{name:"err",algebraicType:t}]})};function E(e,t){return{...e,...t}}var V=class{type;algebraicType;constructor(e){this.algebraicType=e}optional(){return new te(this)}serialize(e,t){U.serializeValue(e,this.algebraicType,t)}deserialize(e){return U.deserializeValue(e,this.algebraicType)}},R=class extends V{constructor(){super(U.U8)}index(e="btree"){return new ge(this,E(ye,{indexType:e}))}unique(){return new ge(this,E(ye,{isUnique:!0}))}primaryKey(){return new ge(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new ge(this,E(ye,{isAutoIncrement:!0}))}default(e){return new ge(this,E(ye,{defaultValue:e}))}name(e){return new ge(this,E(ye,{name:e}))}},C=class extends V{constructor(){super(U.U16)}index(e="btree"){return new be(this,E(ye,{indexType:e}))}unique(){return new be(this,E(ye,{isUnique:!0}))}primaryKey(){return new be(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new be(this,E(ye,{isAutoIncrement:!0}))}default(e){return new be(this,E(ye,{defaultValue:e}))}name(e){return new be(this,E(ye,{name:e}))}},D=class extends V{constructor(){super(U.U32)}index(e="btree"){return new Ie(this,E(ye,{indexType:e}))}unique(){return new Ie(this,E(ye,{isUnique:!0}))}primaryKey(){return new Ie(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new Ie(this,E(ye,{isAutoIncrement:!0}))}default(e){return new Ie(this,E(ye,{defaultValue:e}))}name(e){return new Ie(this,E(ye,{name:e}))}},K=class extends V{constructor(){super(U.U64)}index(e="btree"){return new ve(this,E(ye,{indexType:e}))}unique(){return new ve(this,E(ye,{isUnique:!0}))}primaryKey(){return new ve(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new ve(this,E(ye,{isAutoIncrement:!0}))}default(e){return new ve(this,E(ye,{defaultValue:e}))}name(e){return new ve(this,E(ye,{name:e}))}},N=class extends V{constructor(){super(U.U128)}index(e="btree"){return new _e(this,E(ye,{indexType:e}))}unique(){return new _e(this,E(ye,{isUnique:!0}))}primaryKey(){return new _e(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new _e(this,E(ye,{isAutoIncrement:!0}))}default(e){return new _e(this,E(ye,{defaultValue:e}))}name(e){return new _e(this,E(ye,{name:e}))}},j=class extends V{constructor(){super(U.U256)}index(e="btree"){return new Be(this,E(ye,{indexType:e}))}unique(){return new Be(this,E(ye,{isUnique:!0}))}primaryKey(){return new Be(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new Be(this,E(ye,{isAutoIncrement:!0}))}default(e){return new Be(this,E(ye,{defaultValue:e}))}name(e){return new Be(this,E(ye,{name:e}))}},z=class extends V{constructor(){super(U.I8)}index(e="btree"){return new Ue(this,E(ye,{indexType:e}))}unique(){return new Ue(this,E(ye,{isUnique:!0}))}primaryKey(){return new Ue(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new Ue(this,E(ye,{isAutoIncrement:!0}))}default(e){return new Ue(this,E(ye,{defaultValue:e}))}name(e){return new Ue(this,E(ye,{name:e}))}},$=class extends V{constructor(){super(U.I16)}index(e="btree"){return new xe(this,E(ye,{indexType:e}))}unique(){return new xe(this,E(ye,{isUnique:!0}))}primaryKey(){return new xe(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new xe(this,E(ye,{isAutoIncrement:!0}))}default(e){return new xe(this,E(ye,{defaultValue:e}))}name(e){return new xe(this,E(ye,{name:e}))}},L=class extends V{constructor(){super(U.I32)}index(e="btree"){return new Te(this,E(ye,{indexType:e}))}unique(){return new Te(this,E(ye,{isUnique:!0}))}primaryKey(){return new Te(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new Te(this,E(ye,{isAutoIncrement:!0}))}default(e){return new Te(this,E(ye,{defaultValue:e}))}name(e){return new Te(this,E(ye,{name:e}))}},W=class extends V{constructor(){super(U.I64)}index(e="btree"){return new Me(this,E(ye,{indexType:e}))}unique(){return new Me(this,E(ye,{isUnique:!0}))}primaryKey(){return new Me(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new Me(this,E(ye,{isAutoIncrement:!0}))}default(e){return new Me(this,E(ye,{defaultValue:e}))}name(e){return new Me(this,E(ye,{name:e}))}},H=class extends V{constructor(){super(U.I128)}index(e="btree"){return new Se(this,E(ye,{indexType:e}))}unique(){return new Se(this,E(ye,{isUnique:!0}))}primaryKey(){return new Se(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new Se(this,E(ye,{isAutoIncrement:!0}))}default(e){return new Se(this,E(ye,{defaultValue:e}))}name(e){return new Se(this,E(ye,{name:e}))}},Q=class extends V{constructor(){super(U.I256)}index(e="btree"){return new qe(this,E(ye,{indexType:e}))}unique(){return new qe(this,E(ye,{isUnique:!0}))}primaryKey(){return new qe(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new qe(this,E(ye,{isAutoIncrement:!0}))}default(e){return new qe(this,E(ye,{defaultValue:e}))}name(e){return new qe(this,E(ye,{name:e}))}},Z=class extends V{constructor(){super(U.F32)}default(e){return new Ae(this,E(ye,{defaultValue:e}))}name(e){return new Ae(this,E(ye,{name:e}))}},G=class extends V{constructor(){super(U.F64)}default(e){return new Pe(this,E(ye,{defaultValue:e}))}name(e){return new Pe(this,E(ye,{name:e}))}},X=class extends V{constructor(){super(U.Bool)}index(e="btree"){return new Fe(this,E(ye,{indexType:e}))}unique(){return new Fe(this,E(ye,{isUnique:!0}))}primaryKey(){return new Fe(this,E(ye,{isPrimaryKey:!0}))}default(e){return new Fe(this,E(ye,{defaultValue:e}))}name(e){return new Fe(this,E(ye,{name:e}))}},J=class extends V{constructor(){super(U.String)}index(e="btree"){return new ke(this,E(ye,{indexType:e}))}unique(){return new ke(this,E(ye,{isUnique:!0}))}primaryKey(){return new ke(this,E(ye,{isPrimaryKey:!0}))}default(e){return new ke(this,E(ye,{defaultValue:e}))}name(e){return new ke(this,E(ye,{name:e}))}},Y=class extends V{element;constructor(e){super(U.Array(e.algebraicType)),this.element=e}default(e){return new Oe(this.element,E(ye,{defaultValue:e}))}name(e){return new Oe(this.element,E(ye,{name:e}))}},ee=class extends V{constructor(){super(U.Array(U.U8))}default(e){return new Ee(E(ye,{defaultValue:e}))}name(e){return new Ee(E(ye,{name:e}))}},te=class extends V{value;constructor(e){super(k.getAlgebraicType(e.algebraicType)),this.value=e}default(e){return new Ve(this,E(ye,{defaultValue:e}))}name(e){return new Ve(this,E(ye,{name:e}))}},re=class extends V{typeName;elements;constructor(e,t){var r;super(U.Product({elements:(r=e,Object.keys(r).map(e=>({name:e,get algebraicType(){return r[e].algebraicType}})))})),this.typeName=t,this.elements=e}default(e){return new Ce(this,E(ye,{defaultValue:e}))}name(e){return new Ce(this,E(ye,{name:e}))}},ne=class extends V{ok;err;constructor(e,t){super(O.getAlgebraicType(e.algebraicType,t.algebraicType)),this.ok=e,this.err=t}default(e){return new Re(this,E(ye,{defaultValue:e}))}},ie=class extends V{constructor(){super({tag:"Product",value:{elements:[]}})}},se=class extends V{row;typeName;constructor(e,t){const r=Object.fromEntries(Object.entries(e).map(([e,t])=>[e,t instanceof we?t:new we(t,{})])),n=Object.keys(r).map(e=>({name:e,get algebraicType(){return r[e].typeBuilder.algebraicType}}));super(U.Product({elements:n})),this.row=r,this.typeName=t}},ae=class extends V{variants;typeName;constructor(e,t){var r;super(U.Sum({variants:(r=e,Object.keys(r).map(e=>({name:e,get algebraicType(){return r[e].algebraicType}})))})),this.variants=e,this.typeName=t;for(const t of Object.keys(e)){const r=Object.getOwnPropertyDescriptor(e,t);let n=!1;if(!(!!r&&("function"==typeof r.get||"function"==typeof r.set))){n=e[t]instanceof ie}if(n){const e=this.create(t);Object.defineProperty(this,t,{value:e,writable:!1,enumerable:!0,configurable:!1})}else{const e=e=>this.create(t,e);Object.defineProperty(this,t,{value:e,writable:!1,enumerable:!0,configurable:!1})}}}create(e,t){return void 0===t?{tag:e}:{tag:e,value:t}}default(e){return new De(this,E(ye,{defaultValue:e}))}name(e){return new De(this,E(ye,{name:e}))}},ue=ae,oe=class extends ae{index(e="btree"){return new Ke(this,E(ye,{indexType:e}))}primaryKey(){return new Ke(this,E(ye,{isPrimaryKey:!0}))}},ce=oe,le=class extends V{constructor(){super(F.getAlgebraicType())}default(e){return new Ne(this,E(ye,{defaultValue:e}))}name(e){return new Ne(this,E(ye,{name:e}))}},de=class extends V{constructor(){super(_.getAlgebraicType())}index(e="btree"){return new je(this,E(ye,{indexType:e}))}unique(){return new je(this,E(ye,{isUnique:!0}))}primaryKey(){return new je(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new je(this,E(ye,{isAutoIncrement:!0}))}default(e){return new je(this,E(ye,{defaultValue:e}))}name(e){return new je(this,E(ye,{name:e}))}},he=class extends V{constructor(){super(M.getAlgebraicType())}index(e="btree"){return new ze(this,E(ye,{indexType:e}))}unique(){return new ze(this,E(ye,{isUnique:!0}))}primaryKey(){return new ze(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new ze(this,E(ye,{isAutoIncrement:!0}))}default(e){return new ze(this,E(ye,{defaultValue:e}))}name(e){return new ze(this,E(ye,{name:e}))}},me=class extends V{constructor(){super(r.getAlgebraicType())}index(e="btree"){return new $e(this,E(ye,{indexType:e}))}unique(){return new $e(this,E(ye,{isUnique:!0}))}primaryKey(){return new $e(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new $e(this,E(ye,{isAutoIncrement:!0}))}default(e){return new $e(this,E(ye,{defaultValue:e}))}name(e){return new $e(this,E(ye,{name:e}))}},pe=class extends V{constructor(){super(t.getAlgebraicType())}index(e="btree"){return new Le(this,E(ye,{indexType:e}))}unique(){return new Le(this,E(ye,{isUnique:!0}))}primaryKey(){return new Le(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new Le(this,E(ye,{isAutoIncrement:!0}))}default(e){return new Le(this,E(ye,{defaultValue:e}))}name(e){return new Le(this,E(ye,{name:e}))}},fe=class extends V{constructor(){super(n.getAlgebraicType())}index(e="btree"){return new We(this,E(ye,{indexType:e}))}unique(){return new We(this,E(ye,{isUnique:!0}))}primaryKey(){return new We(this,E(ye,{isPrimaryKey:!0}))}autoInc(){return new We(this,E(ye,{isAutoIncrement:!0}))}default(e){return new We(this,E(ye,{defaultValue:e}))}},ye={},we=class{typeBuilder;columnMetadata;constructor(e,t){this.typeBuilder=e,this.columnMetadata=t}serialize(e,t){U.serializeValue(e,this.typeBuilder.algebraicType,t)}deserialize(e){return U.deserializeValue(e,this.typeBuilder.algebraicType)}},ge=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},be=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Ie=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},ve=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},_e=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Be=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Ue=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},xe=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Te=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Me=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Se=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},qe=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}autoInc(){return new e(this.typeBuilder,E(this.columnMetadata,{isAutoIncrement:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Ae=class e extends we{default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Pe=class e extends we{default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Fe=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},ke=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Oe=class e extends we{default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Ee=class e extends we{constructor(e){super(new V(U.Array(U.U8)),e)}default(t){return new e(E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(E(this.columnMetadata,{name:t}))}},Ve=class e extends we{default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Re=class e extends we{constructor(e,t){super(e,t)}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}},Ce=class e extends we{default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},De=class e extends we{default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Ke=class e extends De{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}},Ne=class e extends we{default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},je=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},ze=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},$e=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},Le=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}name(t){return new e(this.typeBuilder,E(this.columnMetadata,{name:t}))}},We=class e extends we{index(t="btree"){return new e(this.typeBuilder,E(this.columnMetadata,{indexType:t}))}unique(){return new e(this.typeBuilder,E(this.columnMetadata,{isUnique:!0}))}primaryKey(){return new e(this.typeBuilder,E(this.columnMetadata,{isPrimaryKey:!0}))}default(t){return new e(this.typeBuilder,E(this.columnMetadata,{defaultValue:t}))}},He=class extends V{ref;__spacetimeType;constructor(e){super(U.Ref(e)),this.ref=e}},Qe={bool:()=>new X,string:()=>new J,number:()=>new G,i8:()=>new z,u8:()=>new R,i16:()=>new $,u16:()=>new C,i32:()=>new L,u32:()=>new D,i64:()=>new W,u64:()=>new K,i128:()=>new H,u128:()=>new N,i256:()=>new Q,u256:()=>new j,f32:()=>new Z,f64:()=>new G,object:(e,t)=>{if("string"==typeof e){if(!t)throw new TypeError("When providing a name, you must also provide the object.");return new re(t,e)}return new re(e,void 0)},row:(e,t)=>{const[r,n]="string"==typeof e?[t,e]:[e,void 0];return new se(r,n)},array:e=>new Y(e),enum:(e,t)=>{let r,n=e;if("string"==typeof e){if(!t)throw new TypeError("When providing a name, you must also provide the variants object or array.");n=t,r=e}if(Array.isArray(n)){const e={};for(const t of n)e[t]=new ie;return new oe(e,r)}return new ue(n,r)},unit:()=>new ie,lazy(e){let t=null;const r=()=>t??=e();return new Proxy({},{get(e,t,n){const i=r(),s=Reflect.get(i,t,n);return"function"==typeof s?s.bind(i):s},set:(e,t,n,i)=>Reflect.set(r(),t,n,i),has:(e,t)=>t in r(),ownKeys:()=>Reflect.ownKeys(r()),getOwnPropertyDescriptor:(e,t)=>Object.getOwnPropertyDescriptor(r(),t),getPrototypeOf:()=>Object.getPrototypeOf(r())})},scheduleAt:()=>new le,option:e=>new te(e),result:(e,t)=>new ne(e,t),identity:()=>new de,connectionId:()=>new he,timestamp:()=>new me,timeDuration:()=>new pe,uuid:()=>new fe,byteArray:()=>new ee},Ze=Qe.enum("RowSizeHint",{FixedSize:Qe.u16(),RowOffsets:Qe.array(Qe.u64())}),Ge=Qe.object("BsatnRowList",{get sizeHint(){return Ze},rowsData:Qe.byteArray()}),Xe=Qe.object("CallReducer",{reducer:Qe.string(),args:Qe.byteArray(),requestId:Qe.u32(),flags:Qe.u8()}),Je=Qe.object("Subscribe",{queryStrings:Qe.array(Qe.string()),requestId:Qe.u32()}),Ye=Qe.object("OneOffQuery",{messageId:Qe.byteArray(),queryString:Qe.string()}),et=Qe.object("QueryId",{id:Qe.u32()}),tt=Qe.object("SubscribeSingle",{query:Qe.string(),requestId:Qe.u32(),get queryId(){return et}}),rt=Qe.object("SubscribeMulti",{queryStrings:Qe.array(Qe.string()),requestId:Qe.u32(),get queryId(){return et}}),nt=Qe.object("Unsubscribe",{requestId:Qe.u32(),get queryId(){return et}}),it=Qe.object("UnsubscribeMulti",{requestId:Qe.u32(),get queryId(){return et}}),st=Qe.object("CallProcedure",{procedure:Qe.string(),args:Qe.byteArray(),requestId:Qe.u32(),flags:Qe.u8()}),at=Qe.enum("ClientMessage",{get CallReducer(){return Xe},get Subscribe(){return Je},get OneOffQuery(){return Ye},get SubscribeSingle(){return tt},get SubscribeMulti(){return rt},get Unsubscribe(){return nt},get UnsubscribeMulti(){return it},get CallProcedure(){return st}}),ut=Qe.object("QueryUpdate",{get deletes(){return Ge},get inserts(){return Ge}}),ot=Qe.enum("CompressableQueryUpdate",{get Uncompressed(){return ut},Brotli:Qe.byteArray(),Gzip:Qe.byteArray()}),ct=Qe.object("TableUpdate",{tableId:Qe.u32(),tableName:Qe.string(),numRows:Qe.u64(),get updates(){return Qe.array(ot)}}),lt=Qe.object("DatabaseUpdate",{get tables(){return Qe.array(ct)}}),dt=Qe.object("InitialSubscription",{get databaseUpdate(){return lt},requestId:Qe.u32(),totalHostExecutionDuration:Qe.timeDuration()}),ht=Qe.enum("UpdateStatus",{get Committed(){return lt},Failed:Qe.string(),OutOfEnergy:Qe.unit()}),mt=Qe.object("ReducerCallInfo",{reducerName:Qe.string(),reducerId:Qe.u32(),args:Qe.byteArray(),requestId:Qe.u32()}),pt=Qe.object("EnergyQuanta",{quanta:Qe.u128()}),ft=Qe.object("TransactionUpdate",{get status(){return ht},timestamp:Qe.timestamp(),callerIdentity:Qe.identity(),callerConnectionId:Qe.connectionId(),get reducerCall(){return mt},get energyQuantaUsed(){return pt},totalHostExecutionDuration:Qe.timeDuration()}),yt=Qe.object("TransactionUpdateLight",{requestId:Qe.u32(),get update(){return lt}}),wt=Qe.object("IdentityToken",{identity:Qe.identity(),token:Qe.string(),connectionId:Qe.connectionId()}),gt=Qe.object("OneOffTable",{tableName:Qe.string(),get rows(){return Ge}}),bt=Qe.object("OneOffQueryResponse",{messageId:Qe.byteArray(),error:Qe.option(Qe.string()),get tables(){return Qe.array(gt)},totalHostExecutionDuration:Qe.timeDuration()}),It=Qe.object("SubscribeRows",{tableId:Qe.u32(),tableName:Qe.string(),get tableRows(){return ct}}),vt=Qe.object("SubscribeApplied",{requestId:Qe.u32(),totalHostExecutionDurationMicros:Qe.u64(),get queryId(){return et},get rows(){return It}}),_t=Qe.object("UnsubscribeApplied",{requestId:Qe.u32(),totalHostExecutionDurationMicros:Qe.u64(),get queryId(){return et},get rows(){return It}}),Bt=Qe.object("SubscriptionError",{totalHostExecutionDurationMicros:Qe.u64(),requestId:Qe.option(Qe.u32()),queryId:Qe.option(Qe.u32()),tableId:Qe.option(Qe.u32()),error:Qe.string()}),Ut=Qe.object("SubscribeMultiApplied",{requestId:Qe.u32(),totalHostExecutionDurationMicros:Qe.u64(),get queryId(){return et},get update(){return lt}}),xt=Qe.object("UnsubscribeMultiApplied",{requestId:Qe.u32(),totalHostExecutionDurationMicros:Qe.u64(),get queryId(){return et},get update(){return lt}}),Tt=Qe.enum("ProcedureStatus",{Returned:Qe.byteArray(),OutOfEnergy:Qe.unit(),InternalError:Qe.string()}),Mt=Qe.object("ProcedureResult",{get status(){return Tt},timestamp:Qe.timestamp(),totalHostExecutionDuration:Qe.timeDuration(),requestId:Qe.u32()}),St=Qe.enum("ServerMessage",{get InitialSubscription(){return dt},get TransactionUpdate(){return ft},get TransactionUpdateLight(){return yt},get IdentityToken(){return wt},get OneOffQueryResponse(){return bt},get SubscribeApplied(){return vt},get UnsubscribeApplied(){return _t},get SubscriptionError(){return Bt},get SubscribeMultiApplied(){return Ut},get UnsubscribeMultiApplied(){return xt},get ProcedureResult(){return Mt}}),qt=class{#s=new Map;on(e,t){let r=this.#s.get(e);r||(r=new Set,this.#s.set(e,r)),r.add(t)}off(e,t){const r=this.#s.get(e);r&&r.delete(t)}emit(e,...t){const r=this.#s.get(e);if(r)for(const e of r)e(...t)}},At={component:"ðŸ“¦",info:"â„¹ï¸",warn:"âš ï¸",error:"âŒ",debug:"ðŸ›"},Pt={component:"color: #fff; background-color: #8D6FDD; padding: 2px 5px; border-radius: 3px;",info:"color: #fff; background-color: #007bff; padding: 2px 5px; border-radius: 3px;",warn:"color: #fff; background-color: #ffc107; padding: 2px 5px; border-radius: 3px;",error:"color: #fff; background-color: #dc3545; padding: 2px 5px; border-radius: 3px;",debug:"color: #fff; background-color: #28a745; padding: 2px 5px; border-radius: 3px;"},Ft={component:"color: #8D6FDD;",info:"color: #007bff;",warn:"color: #ffc107;",error:"color: #dc3545;",debug:"color: #28a745;"},kt=(e,t)=>{console.log(`%c${At[e]} ${e.toUpperCase()}%c ${t}`,Pt[e],Ft[e])},Ot=(e,t)=>e===t?0:e<t?-1:1,Et=class{rows;tableDef;emitter;constructor(e){this.tableDef=e,this.rows=new Map,this.emitter=new qt;const t=this.tableDef.indexes||[];for(const e of t){const t=e,r=this.#a(this.tableDef,t);this[e.name]=r}}#a(e,t){if("btree"!==t.algorithm)throw new Error("Only btree indexes are supported in TableCacheImpl");const r=t.columns,n=e=>r.map(t=>e[t]),i=(e,t)=>{const r=n(e),i=Array.isArray(t)?t:[t],s=Math.max(0,i.length-1);for(let e=0;e<s;e++)if(!u(r[e],i[e]))return!1;const a=i[i.length-1],o=r[s];if(a&&"object"==typeof a&&"from"in a&&"to"in a){const e=a.from,t=a.to;if("unbounded"!==e.tag){const t=Ot(o,e.value);if(t<0)return!1;if(0===t&&"excluded"===e.tag)return!1}if("unbounded"!==t.tag){const e=Ot(o,t.value);if(e>0)return!1;if(0===e&&"excluded"===t.tag)return!1}return!0}return!!u(o,a)},s=e.constraints.some(e=>"unique"===e.constraint&&u(e.columns,t.columns)),a=this;if(s){return{find:e=>{const t=Array.isArray(e)?e:[e];for(const e of a.iter())if(u(n(e),t))return e;return null}}}return{*filter(e){for(const t of a.iter())i(t,e)&&(yield t)}}}count(){return BigInt(this.rows.size)}iter(){return function*(e){for(const[t]of e.values())yield t}(this.rows)}[Symbol.iterator](){return this.iter()}applyOperations=(e,t)=>{const r=[];if(Object.values(this.tableDef.columns).some(e=>!0===e.columnMetadata.isPrimaryKey)){const n=new Map,i=new Map;for(const t of e)if("insert"===t.type){const[e,r]=n.get(t.rowId)||[t,0];n.set(t.rowId,[t,r+1])}else{const[e,r]=i.get(t.rowId)||[t,0];i.set(t.rowId,[t,r+1])}for(const[e,[s,a]]of n){const n=i.get(e);if(n){const[u,o]=n,c=a-o,l=this.update(t,e,s.row,c);l&&r.push(l),i.delete(e)}else{const e=this.insert(t,s,a);e&&r.push(e)}}for(const[e,n]of i.values()){const i=this.delete(t,e,n);i&&r.push(i)}}else for(const n of e)if("insert"===n.type){const e=this.insert(t,n);e&&r.push(e)}else{const e=this.delete(t,n);e&&r.push(e)}return r};update=(e,t,r,n=0)=>{const i=this.rows.get(t);if(!i)return void kt("error",`Updating a row that was not present in the cache. Table: ${this.tableDef.name}, RowId: ${t}`);const[s,a]=i,u=Math.max(1,a+n);if(!(a+n<=0))return this.rows.set(t,[r,u]),0===a?(kt("error",`Updating a row id in table ${this.tableDef.name} which was not present in the cache (rowId: ${t})`),{type:"insert",table:this.tableDef.name,cb:()=>{this.emitter.emit("insert",e,r)}}):{type:"update",table:this.tableDef.name,cb:()=>{this.emitter.emit("update",e,s,r)}};kt("error",`Negative reference count for in table ${this.tableDef.name} row ${t} (${a} + ${n})`)};insert=(e,t,r=1)=>{const[n,i]=this.rows.get(t.rowId)||[t.row,0];if(this.rows.set(t.rowId,[t.row,i+r]),0===i)return{type:"insert",table:this.tableDef.name,cb:()=>{this.emitter.emit("insert",e,t.row)}}};delete=(e,t,r=1)=>{const[n,i]=this.rows.get(t.rowId)||[t.row,0];if(0!==i)return i<=r?(this.rows.delete(t.rowId),{type:"delete",table:this.tableDef.name,cb:()=>{this.emitter.emit("delete",e,t.row)}}):void this.rows.set(t.rowId,[t.row,i-r]);kt("warn","Deleting a row that was not present in the cache")};onInsert=e=>{this.emitter.on("insert",e)};onDelete=e=>{this.emitter.on("delete",e)};onUpdate=e=>{this.emitter.on("update",e)};removeOnInsert=e=>{this.emitter.off("insert",e)};removeOnDelete=e=>{this.emitter.off("delete",e)};removeOnUpdate=e=>{this.emitter.off("update",e)}},Vt=class{map=new Map;get(e){return this.map.get(e)}set(e,t){return this.map.set(e,t),this}has(e){return this.map.has(e)}delete(e){return this.map.delete(e)}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.entries()}},Rt=class{tables=new Vt;getTable(e){const t=this.tables.get(e);if(!t)throw console.error("The table has not been registered for this client. Please register the table before using it. If you have registered global tables using the SpacetimeDBClient.registerTables() or `registerTable()` method, please make sure that is executed first!"),new Error(`Table ${String(e)} does not exist`);return t}getOrCreateTable(e){const t=e.name,r=this.tables.get(t);if(r)return r;const n=new Et(e);return this.tables.set(t,n),n}};var Ct=class e{major;minor;patch;preRelease;buildInfo;constructor(e,t,r,n=null,i=null){this.major=e,this.minor=t,this.patch=r,this.preRelease=n,this.buildInfo=i}toString(){let e=`${this.major}.${this.minor}.${this.patch}`;return this.preRelease&&(e+=`-${this.preRelease.join(".")}`),this.buildInfo&&(e+=`+${this.buildInfo}`),e}compare(e){return this.major!==e.major?this.major-e.major:this.minor!==e.minor?this.minor-e.minor:this.patch!==e.patch?this.patch-e.patch:this.preRelease&&e.preRelease?function(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const r=e[n],i=t[n];if(r!==i)return"number"==typeof r&&"number"==typeof i?r-i:"string"==typeof r&&"string"==typeof i?r.localeCompare(i):"string"==typeof r?1:-1}return e.length-t.length}(this.preRelease,e.preRelease):this.preRelease||e.preRelease?-1:0}clone(){return new e(this.major,this.minor,this.patch,this.preRelease?[...this.preRelease]:null,this.buildInfo)}static parseVersionString(t){const r=t.match(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?(?:\+([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?$/);if(!r)throw new Error(`Invalid version string: ${t}`);const n=parseInt(r[1],10),i=parseInt(r[2],10),s=parseInt(r[3],10),a=r[4]?r[4].split(".").map(e=>isNaN(Number(e))?e:Number(e)):null,u=r[5]||null;return new e(n,i,s,a,u)}},Dt=new Ct(1,4,0);function Kt(e){return`Module code was generated with an incompatible version of the spacetimedb cli (${e}). Update the cli version to at least ${Dt.toString()} and regenerate the bindings. You can upgrade to the latest cli version by running: spacetime version upgrade`}async function Nt(e,t,r=131072){let n=0;const i=new ReadableStream({pull(t){if(n<e.length){const i=e.subarray(n,Math.min(n+r,e.length));t.enqueue(i),n+=r}else t.close()}}),s=new DecompressionStream(t),a=i.pipeThrough(s).getReader(),u=[];let o,c=0;for(;!(o=await a.read()).done;)u.push(o.value),c+=o.value.length;const l=new Uint8Array(c);let d=0;for(const e of u)l.set(e,d),d+=e.length;return l}var jt=class e{onclose;onopen;onmessage;onerror;#u;async#o(e){const t=new Uint8Array(e.data);let r;if(0===t[0])r=t.slice(1);else{if(1===t[0])throw new Error("Brotli Compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");if(2!==t[0])throw new Error("Unexpected Compression Algorithm. Please use `gzip` or `none`");r=await Nt(t.slice(1),"gzip")}this.onmessage?.({data:r})}#c(e){this.onopen?.(e)}#l(e){this.onerror?.(e)}#d(e){this.onclose?.(e)}send(e){this.#u.send(e)}close(){this.#u.close()}constructor(e){this.onmessage=void 0,this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,e.onmessage=this.#o.bind(this),e.onerror=this.#l.bind(this),e.onclose=this.#d.bind(this),e.onopen=this.#c.bind(this),e.binaryType="arraybuffer",this.#u=e}static async createWebSocketFn({url:t,nameOrAddress:r,wsProtocol:n,authToken:i,compression:s,lightMode:a,confirmedReads:u}){const o=new Headers,c=await async function(){if(void 0!==globalThis.WebSocket)return globalThis.WebSocket;const e=new Function("m","return import(m)");try{const{WebSocket:t}=await e("undici");return t}catch(e){throw console.warn("[spacetimedb-sdk] No global WebSocket found. On Node 18â€“21, please install `undici` (npm install undici) to enable WebSocket support."),e}}();let l;if(i){o.set("Authorization",`Bearer ${i}`);const e=new URL("v1/identity/websocket-token",t);e.protocol="wss:"===t.protocol?"https:":"http:";const r=await fetch(e,{method:"POST",headers:o});if(!r.ok)return Promise.reject(new Error(`Failed to verify token: ${r.statusText}`));{const{token:e}=await r.json();l=e}}const d=new URL(`v1/database/${r}/subscribe`,t);l&&d.searchParams.set("token",l),d.searchParams.set("compression","gzip"===s?"Gzip":"None"),a&&d.searchParams.set("light","true"),void 0!==u&&d.searchParams.set("confirmed",u.toString());const h=new c(d.toString(),n);return new e(h)}},zt=class{constructor(e,t){this.remoteModule=e,this.dbConnectionCtor=t,this.#h=jt.createWebSocketFn}#m;#p;#f;#y;#w=new qt;#g="gzip";#b=!1;#I;#h;withUri(e){return this.#m=new URL(e),this}withModuleName(e){return this.#p=e,this}withToken(e){return this.#y=e,this}withWSFn(e){return this.#h=e,this}withCompression(e){return this.#g=e,this}withLightMode(e){return this.#b=e,this}withConfirmedReads(e){return this.#I=e,this}onConnect(e){return this.#w.on("connect",e),this}onConnectError(e){return this.#w.on("connectError",e),this}onDisconnect(e){return this.#w.on("disconnect",e),this}build(){if(!this.#m)throw new Error("URI is required to connect to SpacetimeDB");if(!this.#p)throw new Error("Database name or address is required to connect to SpacetimeDB");return function(e){if(void 0===e)throw new Error(Kt(e));if(Ct.parseVersionString(e).compare(Dt)<0)throw new Error(Kt(e))}(this.remoteModule.versionInfo?.cliVersion),this.dbConnectionCtor({uri:this.#m,nameOrAddress:this.#p,identity:this.#f,token:this.#y,emitter:this.#w,compression:this.#g,lightMode:this.#b,confirmedReads:this.#I,createWSFn:this.#h,remoteModule:this.remoteModule})}},$t=class{constructor(e){this.db=e}#v=void 0;#_=void 0;onApplied(e){return this.#v=e,this}onError(e){return this.#_=e,this}subscribe(e){const t=Array.isArray(e)?e:[e];if(0===t.length)throw new Error("Subscriptions must have at least one query");return new Wt(this.db,t,this.#v,this.#_)}subscribeToAllTables(){this.subscribe("SELECT * FROM *")}},Lt=class{subscriptions=new Map},Wt=class{constructor(e,t,r,n){this.db=e,this.#w.on("applied",e=>{this.#B=!0,r&&r(e)}),this.#w.on("error",(e,t)=>{this.#B=!1,this.#U=!0,n&&n(e,t)}),this.#x=this.db.registerSubscription(this,this.#w,t)}#x;#T=!1;#U=!1;#B=!1;#w=new qt;unsubscribe(){if(this.#T)throw new Error("Unsubscribe has already been called");this.#T=!0,this.db.unregisterSubscription(this.#x),this.#w.on("end",e=>{this.#U=!0,this.#B=!1})}unsubscribeThen(e){if(this.#U)throw new Error("Subscription has already ended");if(this.#T)throw new Error("Unsubscribe has already been called");this.#T=!0,this.db.unregisterSubscription(this.#x),this.#w.on("end",t=>{this.#U=!0,this.#B=!1,e(t)})}isEnded(){return this.#U}isActive(){return this.#B}};function Ht(e){switch(e){case"FullUpdate":return 0;case"NoSuccessNotify":return 1}}var Qt=class{isActive=!1;identity=void 0;token=void 0;db;reducers;setReducerFlags;procedures;connectionId=M.random();#x=0;#M=0;#w;#S=new qt;#v;#q=Promise.resolve();#A=new Lt;#P;#F=new Map;#k=new Map;clientCache;ws;wsPromise;constructor({uri:e,nameOrAddress:t,identity:r,token:n,emitter:i,remoteModule:s,createWSFn:a,compression:u,lightMode:o,confirmedReads:c}){kt("info","Connecting to SpacetimeDB WS...");const l=new URL(e.toString());/^wss?:/.test(e.protocol)||(l.protocol="https:"===l.protocol?"wss:":"ws:"),this.identity=r,this.token=n,this.#P=s,this.#w=i;const d=this.connectionId.toHexString();l.searchParams.set("connection_id",d),this.clientCache=new Rt,this.db=this.#O(s),this.reducers=this.#E(s),this.setReducerFlags=this.#V(s),this.procedures=this.#R(s),this.wsPromise=a({url:l,nameOrAddress:t,wsProtocol:"v1.bsatn.spacetimedb",authToken:n,compression:u,lightMode:o,confirmedReads:c}).then(e=>(this.ws=e,this.ws.onclose=()=>{this.#w.emit("disconnect",this),this.isActive=!1},this.ws.onerror=e=>{this.#w.emit("connectError",this,e),this.isActive=!1},this.ws.onopen=this.#c.bind(this),this.ws.onmessage=this.#o.bind(this),e)).catch(e=>{kt("error","Error connecting to SpacetimeDB WS"),this.#w.emit("connectError",this,e)})}#C=()=>{const e=this.#x;return this.#x+=1,e};#D=()=>this.#M++;#O(e){const t=Object.create(null);for(const r of e.tables){const e=r.accessorName;Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:()=>this.clientCache.getOrCreateTable(r)})}return t}#E(e){const t={};for(const r of e.reducers){t[g(r.name)]=e=>{const t=this.#F.get(r.name)??"FullUpdate";this.callReducerWithParams(r.name,r.paramsType,e,t)};t[`on${a(r.name)}`]=e=>{this.onReducer(r.name,e)};t[`removeOn${a(r.name)}`]=e=>{this.offReducer(r.name,e)}}return t}#V(e){const t=Object.create(null);for(const r of e.reducers){const e=g(r.name);Object.defineProperty(t,e,{enumerable:!0,configurable:!1,value:e=>{this.#F.set(r.name,e)}})}return t}#R(e){const t={};for(const r of e.procedures){const e=g(r.name),n=new re(r.params).algebraicType.value,i=r.returnType.algebraicType;t[e]=e=>this.callProcedureWithParams(r.name,n,e,i)}return t}#K(e){return{db:this.db,reducers:this.reducers,setReducerFlags:this.setReducerFlags,isActive:this.isActive,subscriptionBuilder:this.subscriptionBuilder.bind(this),disconnect:this.disconnect.bind(this),event:e}}subscriptionBuilder=()=>new $t(this);registerSubscription(e,t,r){const n=this.#C();return this.#A.subscriptions.set(n,{handle:e,emitter:t}),this.#N(at.SubscribeMulti({queryStrings:r,queryId:{id:n},requestId:0})),n}unregisterSubscription(e){this.#N(at.UnsubscribeMulti({queryId:{id:e},requestId:0}))}async#j(t){const r=(t,r,n)=>{const i=n.rowsData,a=new s(i),u=[],o=this.#P.tables.find(e=>e.name===r),c=o.rowType,l=Object.entries(o.columns).find(e=>e[1].columnMetadata.isPrimaryKey);let d=0;for(;a.remaining>0;){const r=x.deserializeValue(a,c);let n;if(void 0!==l){const e=l[0],t=l[1].typeBuilder.algebraicType;n=U.intoMapKey(t,r[e])}else{const t=i.subarray(d,a.offset);n=e(t)}d=a.offset,u.push({type:t,rowId:n,row:r})}return u},n=async e=>{const t=e.tableName;let n=[];for(const i of e.updates){let e;if("Gzip"===i.tag){const t=await Nt(i.value,"gzip");e=U.deserializeValue(new s(t),ut.algebraicType)}else{if("Brotli"===i.tag)throw new Error("Brotli compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");e=i.value}n=n.concat(r("insert",t,e.inserts)),n=n.concat(r("delete",t,e.deletes))}return{tableName:t,operations:n}},i=async e=>{const t=[];for(const r of e.tables)t.push(await n(r));return t};switch(t.tag){case"InitialSubscription":{const e=t.value.databaseUpdate;return{tag:"InitialSubscription",tableUpdates:await i(e)}}case"TransactionUpdateLight":{const e=t.value.update;return{tag:"TransactionUpdateLight",tableUpdates:await i(e)}}case"TransactionUpdate":{const e=t.value,r=e.callerIdentity,n=M.nullIfZero(e.callerConnectionId),s=e.reducerCall.reducerName,a=e.reducerCall.args,u=e.energyQuantaUsed;let o,c=[],l="";switch(e.status.tag){case"Committed":c=await i(e.status.value);break;case"Failed":c=[],l=e.status.value;break;case"OutOfEnergy":c=[]}if("<none>"===s){const e=l;return void console.error(`Received an error from the database: ${e}`)}""!==s&&(o={reducerName:s,args:a});return{tag:"TransactionUpdate",tableUpdates:c,identity:r,connectionId:n,reducerInfo:o,status:e.status,energyConsumed:u.quanta,message:l,timestamp:e.timestamp}}case"IdentityToken":return{tag:"IdentityToken",identity:t.value.identity,token:t.value.token,connectionId:t.value.connectionId};case"OneOffQueryResponse":throw new Error(`TypeScript SDK never sends one-off queries, but got OneOffQueryResponse ${t}`);case"SubscribeMultiApplied":{const e=await i(t.value.update);return{tag:"SubscribeApplied",queryId:t.value.queryId.id,tableUpdates:e}}case"UnsubscribeMultiApplied":{const e=await i(t.value.update);return{tag:"UnsubscribeApplied",queryId:t.value.queryId.id,tableUpdates:e}}case"SubscriptionError":return{tag:"SubscriptionError",queryId:t.value.queryId,error:t.value.error};case"ProcedureResult":{const{status:e,requestId:r}=t.value;return{tag:"ProcedureResult",requestId:r,result:"Returned"===e.tag?{tag:"Ok",value:e.value}:"OutOfEnergy"===e.tag?{tag:"Err",value:"Procedure execution aborted due to insufficient energy"}:{tag:"Err",value:e.value}}}}}#N(e){this.wsPromise.then(t=>{if(t){const r=new i(1024);U.serializeValue(r,at.algebraicType,e);const n=r.getBuffer();t.send(n)}})}#c(){this.isActive=!0}#z(e,t){const r=[];for(const n of e){const e=n.tableName,i=this.#P.tables.find(t=>t.name===e),s=this.clientCache.getOrCreateTable(i).applyOperations(n.operations,t);for(const e of s)r.push(e)}return r}async#$(e){const t=U.deserializeValue(new s(e),St.algebraicType),r=await this.#j(t);if(r)switch(r.tag){case"InitialSubscription":{const e={tag:"SubscribeApplied"},t=this.#K(e),{event:n,...i}=t,s=this.#z(r.tableUpdates,t);this.#w&&this.#v?.(i);for(const e of s)e.cb();break}case"TransactionUpdateLight":{const e={tag:"UnknownTransaction"},t=this.#K(e),n=this.#z(r.tableUpdates,t);for(const e of n)e.cb();break}case"TransactionUpdate":{let e=r.reducerInfo;const t=void 0===e?void 0:this.#P.reducers.find(t=>t.name===e.reducerName);let n,i=void 0===t;if(t)try{const r=new s(e.args);n=x.deserializeValue(r,t.paramsType)}catch{console.debug("Failed to deserialize reducer arguments"),i=!0}if(i){const e={tag:"UnknownTransaction"},t=this.#K(e),n=this.#z(r.tableUpdates,t);for(const e of n)e.cb();return}const a={callerIdentity:r.identity,status:r.status,callerConnectionId:r.connectionId,timestamp:r.timestamp,energyConsumed:r.energyConsumed,reducer:{name:e.reducerName,args:n}},u={tag:"Reducer",value:a},o=this.#K(u),c={...o,event:a},l=this.#z(r.tableUpdates,o);this.#S.emit(e.reducerName,c,n);for(const e of l)e.cb();break}case"IdentityToken":this.identity=r.identity,!this.token&&r.token&&(this.token=r.token),this.connectionId=r.connectionId,this.#w.emit("connect",this,this.identity,this.token);break;case"SubscribeApplied":{const e=this.#A.subscriptions.get(r.queryId);if(void 0===e){kt("error",`Received SubscribeApplied for unknown queryId ${r.queryId}.`);break}const t={tag:"SubscribeApplied"},n=this.#K(t),{event:i,...s}=n,a=this.#z(r.tableUpdates,n);e?.emitter.emit("applied",s);for(const e of a)e.cb();break}case"UnsubscribeApplied":{const e=this.#A.subscriptions.get(r.queryId);if(void 0===e){kt("error",`Received UnsubscribeApplied for unknown queryId ${r.queryId}.`);break}const t={tag:"UnsubscribeApplied"},n=this.#K(t),{event:i,...s}=n,a=this.#z(r.tableUpdates,n);e?.emitter.emit("end",s),this.#A.subscriptions.delete(r.queryId);for(const e of a)e.cb();break}case"SubscriptionError":{const e=Error(r.error),t={tag:"Error",value:e},n={...this.#K(t),event:e};void 0!==r.queryId?(this.#A.subscriptions.get(r.queryId)?.emitter.emit("error",n,e),this.#A.subscriptions.delete(r.queryId)):(console.error("Received an error message without a queryId: ",e),this.#A.subscriptions.forEach(({emitter:t})=>{t.emit("error",n,e)}));break}case"ProcedureResult":{const{requestId:e,result:t}=r,n=this.#k.get(e);this.#k.delete(e),n?.(t);break}}}#o(e){this.#q=this.#q.then(()=>this.#$(e.data))}callReducer(e,t,r){const n=at.CallReducer({reducer:e,args:t,requestId:0,flags:Ht(r)});this.#N(n)}callReducerWithParams(e,t,r,n){const s=new i(1024);x.serializeValue(s,t,r);const a=s.getBuffer();this.callReducer(e,a,n)}callProcedure(e,t){const{promise:r,resolve:n,reject:i}=Promise.withResolvers(),s=this.#D(),a=at.CallProcedure({procedure:e,args:t,requestId:s,flags:0});return this.#N(a),this.#k.set(s,e=>{"Ok"===e.tag?n(e.value):i(e.value)}),r}callProcedureWithParams(e,t,r,n){const a=new i(1024);x.serializeValue(a,t,r);const u=a.getBuffer();return this.callProcedure(e,u).then(e=>U.deserializeValue(new s(e),n))}disconnect(){this.wsPromise.then(e=>{e&&e.close()})}on(e,t){this.#w.on(e,t)}off(e,t){this.#w.off(e,t)}onConnect(e){this.#w.on("connect",e)}onDisconnect(e){this.#w.on("disconnect",e)}onConnectError(e){this.#w.on("connectError",e)}removeOnConnect(e){this.#w.off("connect",e)}removeOnDisconnect(e){this.#w.off("disconnect",e)}removeOnConnectError(e){this.#w.off("connectError",e)}onReducer(e,t){this.#S.on(e,t)}offReducer(e,t){this.#S.off(e,t)}},Zt=Qe.enum("Lifecycle",{Init:Qe.unit(),OnConnect:Qe.unit(),OnDisconnect:Qe.unit()});function Gt(e,t,r,n){if(Xt.has(e))throw new TypeError(`There is already a reducer with the name '${e}'`);Xt.add(e),t instanceof se||(t=new se(t)),void 0===t.typeName&&(t.typeName=a(e));const i=mr(t),s=hr(lr.typespace,i).value;lr.reducers.push({name:e,params:s,lifecycle:n}),r.name||Object.defineProperty(r,"name",{value:e,writable:!1})}var Xt=new Set;function Jt(e,t,r){Gt(e,t,r)}var Yt=class{reducersType;constructor(e){this.reducersType=function(e){const t=e.map(e=>{const t=e.params.row;return{name:e.reducerName,accessorName:e.accessorName,params:t,paramsType:e.paramsSpacetimeType}});return{reducers:t}}(e)}};function er(...e){const t=1===e.length&&Array.isArray(e[0])?e[0]:e;return new Yt(t)}function tr(e,t){const r={elements:Object.entries(t).map(([e,t])=>({name:e,algebraicType:"typeBuilder"in t?t.typeBuilder.algebraicType:t.algebraicType}))};return{reducerName:e,accessorName:g(e),params:new se(t),paramsSpacetimeType:r,reducerDef:{name:e,params:r,lifecycle:void 0}}}function rr(e,t,r,n,i){const s=new se(r,a(e.name));let u=mr(n).algebraicType;const{value:o}=hr(lr.typespace,mr(s));if(lr.miscExports.push({tag:"View",value:{name:e.name,index:(t?ir:nr).length,isPublic:e.public,isAnonymous:t,params:o,returnType:u}}),"Sum"==u.tag){const e=i;i=(t,r)=>{const n=e(t,r);return null==n?[]:[n]},u=U.Array(u.value.variants[0].algebraicType)}(t?ir:nr).push({fn:i,params:o,returnType:u,returnTypeBaseSize:I(lr.typespace,u)})}var nr=[],ir=[];function sr(e,t,r,n){const i={elements:Object.entries(t).map(([e,t])=>({name:e,algebraicType:mr("typeBuilder"in t?t.typeBuilder:t).algebraicType}))},s=mr(r).algebraicType;lr.miscExports.push({tag:"Procedure",value:{name:e,params:i,returnType:s}}),ar.push({fn:n,paramsType:i,returnType:s,returnTypeBaseSize:I(lr.typespace,s)})}var ar=[];function ur(...e){return{procedures:1===e.length&&Array.isArray(e[0])?e[0]:e}}function or(e,t,r){return{name:e,accessorName:g(e),params:v(t),returnType:r}}function cr(e){const t=t=>e.rowType.algebraicType.value.elements[t].name;return{name:e.tableName,accessorName:g(e.tableName),columns:e.rowType.row,rowType:e.rowSpacetimeType,constraints:e.tableDef.constraints.map(e=>({name:e.name,constraint:"unique",columns:e.data.value.columns.map(t)})),indexes:e.tableDef.indexes.map(r=>{const n="Direct"===r.algorithm.tag?[r.algorithm.value]:r.algorithm.value;return{name:r.accessorName,unique:e.tableDef.constraints.some(e=>e.data.value.columns.every(e=>n.includes(e))),algorithm:r.algorithm.tag.toLowerCase(),columns:n.map(t)}})}}var lr={typespace:{types:[]},tables:[],reducers:[],types:[],miscExports:[],rowLevelSecurity:[]},dr=new Map;function hr(e,t){let r=t.algebraicType;for(;"Ref"===r.tag;)r=e.types[r.value];return r}function mr(e){return e instanceof re&&!function(e){return null==e.typeName&&0===e.algebraicType.value.elements.length}(e)||e instanceof ue||e instanceof se?function(e){const t=e.algebraicType,r=e.typeName;if(void 0===r)throw new Error(`Missing type name for ${e.constructor.name??"TypeBuilder"} ${JSON.stringify(e)}`);let n=dr.get(t);if(null!=n)return n;const i=e instanceof se||e instanceof re?{tag:"Product",value:{elements:[]}}:{tag:"Sum",value:{variants:[]}};if(n=new He(lr.typespace.types.length),lr.typespace.types.push(i),dr.set(t,n),e instanceof se)for(const[t,r]of Object.entries(e.row))i.value.elements.push({name:t,algebraicType:mr(r.typeBuilder).algebraicType});else if(e instanceof re)for(const[t,r]of Object.entries(e.elements))i.value.elements.push({name:t,algebraicType:mr(r).algebraicType});else if(e instanceof ue)for(const[t,r]of Object.entries(e.variants))i.value.variants.push({name:t,algebraicType:mr(r).algebraicType});return lr.types.push({name:pr(r),ty:n.ref,customOrdering:!0}),n}(e):e instanceof te?new te(mr(e.value)):e instanceof ne?new ne(mr(e.ok),mr(e.err)):e instanceof Y?new Y(mr(e.element)):e}function pr(e){const t=e.split(".");return{name:t.pop(),scope:t}}var fr=class{tablesDef;typespace;schemaType;constructor(e,t,r){this.tablesDef={tables:e},this.typespace=t,this.schemaType=function(e){return{tables:e.map(cr)}}(r)}reducer(e,t,r){return"function"==typeof t?(Jt(e,{},t),t):(Jt(e,t,r),r)}init(e,t){const[r,n]="string"==typeof e?[e,t]:["init",e];!function(e,t,r){Gt(e,t,r,Zt.Init)}(r,{},n)}clientConnected(e,t){const[r,n]="string"==typeof e?[e,t]:["on_connect",e];!function(e,t,r){Gt(e,t,r,Zt.OnConnect)}(r,{},n)}clientDisconnected(e,t){const[r,n]="string"==typeof e?[e,t]:["on_disconnect",e];!function(e,t,r){Gt(e,t,r,Zt.OnDisconnect)}(r,{},n)}view(e,t,r){rr(e,!1,{},t,r)}anonymousView(e,t,r){rr(e,!0,{},t,r)}procedure(e,t,r,n){return"function"==typeof r?(sr(e,{},t,r),r):(sr(e,t,r,n),n)}clientVisibilityFilter={sql(e){lr.rowLevelSecurity.push({sql:e})}}};function yr(...e){const t=1===e.length&&Array.isArray(e[0])?e[0]:e,r=t.map(e=>e.tableDef);return lr.tables.push(...r),t.map(e=>({name:e.tableName,accessorName:e.tableName,columns:e.rowType.row,rowType:e.rowSpacetimeType,indexes:e.idxs,constraints:e.constraints})),new fr(r,lr.typespace,t)}function wr(e){return Object.fromEntries(e.map(e=>[e.accessorName,e]))}var gr=Qe.enum("RawIndexAlgorithm",{BTree:Qe.array(Qe.u16()),Hash:Qe.array(Qe.u16()),Direct:Qe.u16()});function br(e,t){const{name:r,public:n=!1,indexes:i=[],scheduled:s}=e,u=new Map,o=[];t instanceof se||(t=new se(t)),void 0===t.typeName&&(t.typeName=a(r));const c=mr(t);t.algebraicType.value.elements.forEach((e,t)=>{u.set(e.name,t),o.push(e.name)});const l=[],d=[],h=[],m=[];let p;for(const[e,r]of Object.entries(t.row)){const t=r.columnMetadata;t.isPrimaryKey&&l.push(u.get(e));const n=t.isUnique||t.isPrimaryKey;if(t.indexType||n){const r=t.indexType??"btree",n=u.get(e);let i;switch(r){case"btree":i=gr.BTree([n]);break;case"direct":i=gr.Direct(n)}d.push({name:void 0,accessorName:e,algorithm:i})}if(n&&h.push({name:void 0,data:{tag:"Unique",value:{columns:[u.get(e)]}}}),t.isAutoIncrement&&m.push({name:void 0,start:void 0,minValue:void 0,maxValue:void 0,column:u.get(e),increment:1n}),s){const t=r.typeBuilder.algebraicType;F.isScheduleAt(t)&&(p=u.get(e))}}for(const e of i??[]){let t;switch(e.algorithm){case"btree":t={tag:"BTree",value:e.columns.map(e=>u.get(e))};break;case"direct":t={tag:"Direct",value:u.get(e.column)}}d.push({name:void 0,accessorName:e.name,algorithm:t})}for(const t of e.constraints??[])if("unique"===t.constraint){const e={tag:"Unique",value:{columns:t.columns.map(e=>u.get(e))}};h.push({name:t.name,data:e});continue}for(const e of d){const t=("Direct"===e.algorithm.tag?[e.algorithm.value]:e.algorithm.value).map(e=>o[e]).join("_");e.name=`${r}_${t}_idx_${e.algorithm.tag.toLowerCase()}`}const f={name:r,productTypeRef:c.ref,primaryKey:l,indexes:d,constraints:h,sequences:m,schedule:s&&void 0!==p?{name:void 0,reducerName:s,scheduledAtColumn:p}:void 0,tableType:{tag:"User"},tableAccess:{tag:n?"Public":"Private"}};return{rowType:t,tableName:r,rowSpacetimeType:t.algebraicType.value,tableDef:f,idxs:{},constraints:h}}export{U as AlgebraicType,B as AlgebraicTypeVariants,Y as ArrayBuilder,Oe as ArrayColumnBuilder,s as BinaryReader,i as BinaryWriter,X as BoolBuilder,Fe as BoolColumnBuilder,ee as ByteArrayBuilder,Ee as ByteArrayColumnBuilder,Rt as ClientCache,we as ColumnBuilder,M as ConnectionId,he as ConnectionIdBuilder,ze as ConnectionIdColumnBuilder,zt as DbConnectionBuilder,Qt as DbConnectionImpl,Z as F32Builder,Ae as F32ColumnBuilder,G as F64Builder,Pe as F64ColumnBuilder,H as I128Builder,Se as I128ColumnBuilder,$ as I16Builder,xe as I16ColumnBuilder,Q as I256Builder,qe as I256ColumnBuilder,L as I32Builder,Te as I32ColumnBuilder,W as I64Builder,Me as I64ColumnBuilder,z as I8Builder,Ue as I8ColumnBuilder,_ as Identity,de as IdentityBuilder,je as IdentityColumnBuilder,A as Interval,k as Option,te as OptionBuilder,Ve as OptionColumnBuilder,re as ProductBuilder,Ce as ProductColumnBuilder,x as ProductType,He as RefBuilder,O as Result,ne as ResultBuilder,Re as ResultColumnBuilder,se as RowBuilder,q as ScheduleAt,le as ScheduleAtBuilder,Ne as ScheduleAtColumnBuilder,ce as SimpleSumBuilder,Ke as SimpleSumColumnBuilder,J as StringBuilder,ke as StringColumnBuilder,$t as SubscriptionBuilderImpl,Wt as SubscriptionHandleImpl,ue as SumBuilder,De as SumColumnBuilder,T as SumType,P as Time,t as TimeDuration,pe as TimeDurationBuilder,Le as TimeDurationColumnBuilder,r as Timestamp,me as TimestampBuilder,$e as TimestampColumnBuilder,V as TypeBuilder,N as U128Builder,_e as U128ColumnBuilder,C as U16Builder,be as U16ColumnBuilder,j as U256Builder,Be as U256ColumnBuilder,D as U32Builder,Ie as U32ColumnBuilder,K as U64Builder,ve as U64ColumnBuilder,R as U8Builder,ge as U8ColumnBuilder,n as Uuid,fe as UuidBuilder,We as UuidColumnBuilder,I as bsatnBaseSize,v as coerceParams,wr as convertToAccessorMap,u as deepEqual,h as hexStringToU128,m as hexStringToU256,d as hexStringToUint8Array,S as parseValue,or as procedureSchema,ur as procedures,tr as reducerSchema,er as reducers,yr as schema,Qe as t,br as table,g as toCamelCase,a as toPascalCase,b as toSnakeCase,f as u128ToHexString,p as u128ToUint8Array,w as u256ToHexString,y as u256ToUint8Array,o as uint8ArrayToHexString,c as uint8ArrayToU128,l as uint8ArrayToU256};//# sourceMappingURL=index.browser.mjs.map