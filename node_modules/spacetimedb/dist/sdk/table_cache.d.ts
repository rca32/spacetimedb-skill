import { type ComparablePrimitive } from '../';
import type { EventContextInterface, TableDefForTableName } from './index.ts';
import type { RowType, TableIndexes, UntypedTableDef } from '../lib/table.ts';
import type { ClientTableCoreImplementable } from './client_table.ts';
import type { UntypedRemoteModule } from './spacetime_module.ts';
import type { TableNamesOf } from '../lib/schema.ts';
import type { ReadonlyIndexes } from '../lib/indexes.ts';
import type { Prettify } from '../lib/type_util.ts';
export type Operation<RowType extends Record<string, any> = Record<string, any>> = {
    type: 'insert' | 'delete';
    rowId: ComparablePrimitive;
    row: RowType;
};
export type TableUpdate<TableDef extends UntypedTableDef> = {
    tableName: string;
    operations: Operation<RowType<TableDef>>[];
};
export type PendingCallback = {
    type: 'insert' | 'delete' | 'update';
    table: string;
    cb: () => void;
};
export type TableIndexView<RemoteModule extends UntypedRemoteModule, TableName extends TableNamesOf<RemoteModule>> = ReadonlyIndexes<TableDefForTableName<RemoteModule, TableName>, TableIndexes<TableDefForTableName<RemoteModule, TableName>>>;
export type TableCache<RemoteModule extends UntypedRemoteModule, TableName extends TableNamesOf<RemoteModule>> = TableCacheImpl<RemoteModule, TableName> & TableIndexView<RemoteModule, TableName>;
/**
 * Builder to generate calls to query a `table` in the database
 */
export declare class TableCacheImpl<RemoteModule extends UntypedRemoteModule, TableName extends TableNamesOf<RemoteModule>> implements ClientTableCoreImplementable<RemoteModule, TableName> {
    #private;
    private rows;
    private tableDef;
    private emitter;
    /**
     * @param name the table name
     * @param primaryKeyCol column index designated as `#[primarykey]`
     * @param primaryKey column name designated as `#[primarykey]`
     * @param entityClass the entityClass
     */
    constructor(tableDef: TableDefForTableName<RemoteModule, TableName>);
    /**
     * @returns number of rows in the table
     */
    count(): bigint;
    /**
     * @returns The values of the rows in the table
     */
    iter(): IteratorObject<Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>, undefined>;
    /**
     * Allows iteration over the rows in the table
     * @returns An iterator over the rows in the table
     */
    [Symbol.iterator](): IteratorObject<Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>, undefined>;
    applyOperations: (operations: Operation<RowType<TableDefForTableName<RemoteModule, TableName>>>[], ctx: EventContextInterface<RemoteModule>) => PendingCallback[];
    update: (ctx: EventContextInterface<RemoteModule>, rowId: ComparablePrimitive, newRow: RowType<TableDefForTableName<RemoteModule, TableName>>, refCountDelta?: number) => PendingCallback | undefined;
    insert: (ctx: EventContextInterface<RemoteModule>, operation: Operation<RowType<TableDefForTableName<RemoteModule, TableName>>>, count?: number) => PendingCallback | undefined;
    delete: (ctx: EventContextInterface<RemoteModule>, operation: Operation<RowType<TableDefForTableName<RemoteModule, TableName>>>, count?: number) => PendingCallback | undefined;
    /**
     * Register a callback for when a row is newly inserted into the database.
     *
     * ```ts
     * ctx.db.user.onInsert((reducerEvent, user) => {
     *   if (reducerEvent) {
     *      console.log("New user on reducer", reducerEvent, user);
     *   } else {
     *      console.log("New user received during subscription update on insert", user);
     *  }
     * });
     * ```
     *
     * @param cb Callback to be called when a new row is inserted
     */
    onInsert: (cb: (ctx: EventContextInterface<RemoteModule>, row: Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>) => void) => void;
    /**
     * Register a callback for when a row is deleted from the database.
     *
     * ```ts
     * ctx.db.user.onDelete((reducerEvent, user) => {
     *   if (reducerEvent) {
     *      console.log("Deleted user on reducer", reducerEvent, user);
     *   } else {
     *      console.log("Deleted user received during subscription update on update", user);
     *  }
     * });
     * ```
     *
     * @param cb Callback to be called when a new row is inserted
     */
    onDelete: (cb: (ctx: EventContextInterface<RemoteModule>, row: Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>) => void) => void;
    /**
     * Register a callback for when a row is updated into the database.
     *
     * ```ts
     * ctx.db.user.onInsert((reducerEvent, oldUser, user) => {
     *   if (reducerEvent) {
     *      console.log("Updated user on reducer", reducerEvent, user);
     *   } else {
     *      console.log("Updated user received during subscription update on delete", user);
     *  }
     * });
     * ```
     *
     * @param cb Callback to be called when a new row is inserted
     */
    onUpdate: (cb: (ctx: EventContextInterface<RemoteModule>, oldRow: Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>, row: Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>) => void) => void;
    /**
     * Remove a callback for when a row is newly inserted into the database.
     *
     * @param cb Callback to be removed
     */
    removeOnInsert: (cb: (ctx: EventContextInterface<RemoteModule>, row: Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>) => void) => void;
    /**
     * Remove a callback for when a row is deleted from the database.
     *
     * @param cb Callback to be removed
     */
    removeOnDelete: (cb: (ctx: EventContextInterface<RemoteModule>, row: Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>) => void) => void;
    /**
     * Remove a callback for when a row is updated into the database.
     *
     * @param cb Callback to be removed
     */
    removeOnUpdate: (cb: (ctx: EventContextInterface<RemoteModule>, oldRow: Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>, row: Prettify<RowType<TableDefForTableName<RemoteModule, TableName>>>) => void) => void;
}
//# sourceMappingURL=table_cache.d.ts.map