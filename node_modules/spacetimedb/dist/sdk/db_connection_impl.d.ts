import { ConnectionId, ProductType } from '../';
import { AlgebraicType } from '../';
import { DbConnectionBuilder } from './db_connection_builder.ts';
import { type DbContext } from './db_context.ts';
import type { Event } from './event.ts';
import { type ErrorContextInterface, type EventContextInterface, type ReducerEventContextInterface, type SubscriptionEventContextInterface } from './event_context.ts';
import { EventEmitter } from './event_emitter.ts';
import type { Identity } from '../';
import type { ReducerEvent } from './reducer_event.ts';
import { type UntypedRemoteModule } from './spacetime_module.ts';
import { type TableCache } from './table_cache.ts';
import { WebsocketDecompressAdapter } from './websocket_decompress_adapter.ts';
import { SubscriptionBuilderImpl, SubscriptionHandleImpl, type SubscribeEvent } from './subscription_builder_impl.ts';
import type { ReducerEventCallback, ReducersView, SetReducerFlags, SubscriptionEventCallback } from './reducers.ts';
import type { ClientDbView } from './db_view.ts';
import type { ProceduresView } from './procedures.ts';
export { DbConnectionBuilder, SubscriptionBuilderImpl, SubscriptionHandleImpl, type TableCache, type Event, };
export type RemoteModuleOf<C> = C extends DbConnectionImpl<infer RM> ? RM : never;
export type { DbContext, EventContextInterface, ReducerEventContextInterface, SubscriptionEventContextInterface, ErrorContextInterface, ReducerEvent, };
export type ConnectionEvent = 'connect' | 'disconnect' | 'connectError';
export type CallReducerFlags = 'FullUpdate' | 'NoSuccessNotify';
export type DbConnectionConfig<RemoteModule extends UntypedRemoteModule> = {
    uri: URL;
    nameOrAddress: string;
    identity?: Identity;
    token?: string;
    emitter: EventEmitter<ConnectionEvent>;
    createWSFn: typeof WebsocketDecompressAdapter.createWebSocketFn;
    compression: 'gzip' | 'none';
    lightMode: boolean;
    confirmedReads?: boolean;
    remoteModule: RemoteModule;
};
export declare class DbConnectionImpl<RemoteModule extends UntypedRemoteModule> implements DbContext<RemoteModule> {
    #private;
    /**
     * Whether or not the connection is active.
     */
    isActive: boolean;
    /**
     * This connection's public identity.
     */
    identity?: Identity;
    /**
     * This connection's private authentication token.
     */
    token?: string;
    /**
     * The accessor field to access the tables in the database and associated
     * callback functions.
     */
    db: ClientDbView<RemoteModule>;
    /**
     * The accessor field to access the reducers in the database and associated
     * callback functions.
     */
    reducers: ReducersView<RemoteModule>;
    /**
     * The accessor field to access functions related to setting flags on
     * reducers regarding how the server should handle the reducer call and
     * the events that it sends back to the client.
     */
    setReducerFlags: SetReducerFlags<RemoteModule>;
    /**
     * The accessor field to access the reducers in the database and associated
     * callback functions.
     */
    procedures: ProceduresView<RemoteModule>;
    /**
     * The `ConnectionId` of the connection to to the database.
     */
    connectionId: ConnectionId;
    private clientCache;
    private ws?;
    private wsPromise;
    constructor({ uri, nameOrAddress, identity, token, emitter, remoteModule, createWSFn, compression, lightMode, confirmedReads, }: DbConnectionConfig<RemoteModule>);
    subscriptionBuilder: () => SubscriptionBuilderImpl<RemoteModule>;
    registerSubscription(handle: SubscriptionHandleImpl<RemoteModule>, handleEmitter: EventEmitter<SubscribeEvent, SubscriptionEventCallback<RemoteModule>>, querySql: string[]): number;
    unregisterSubscription(queryId: number): void;
    /**
     * Call a reducer on your SpacetimeDB module.
     *
     * @param reducerName The name of the reducer to call
     * @param argsSerializer The arguments to pass to the reducer
     */
    callReducer(reducerName: string, argsBuffer: Uint8Array, flags: CallReducerFlags): void;
    /**
     * Call a reducer on your SpacetimeDB module with typed arguments.
     * @param reducerSchema The schema of the reducer to call
     * @param callReducerFlags The flags for the reducer call
     * @param params The arguments to pass to the reducer
     */
    callReducerWithParams(reducerName: string, paramsType: ProductType, params: object, flags: CallReducerFlags): void;
    /**
     * Call a reducer on your SpacetimeDB module.
     *
     * @param procedureName The name of the reducer to call
     * @param argsBuffer The arguments to pass to the reducer
     */
    callProcedure(procedureName: string, argsBuffer: Uint8Array): Promise<Uint8Array>;
    /**
     * Call a reducer on your SpacetimeDB module with typed arguments.
     * @param reducerSchema The schema of the reducer to call
     * @param callReducerFlags The flags for the reducer call
     * @param params The arguments to pass to the reducer
     */
    callProcedureWithParams(procedureName: string, paramsType: ProductType, params: object, returnType: AlgebraicType): Promise<any>;
    /**
     * Close the current connection.
     *
     * @example
     *
     * ```ts
     * const connection = DbConnection.builder().build();
     * connection.disconnect()
     * ```
     */
    disconnect(): void;
    private on;
    private off;
    private onConnect;
    private onDisconnect;
    private onConnectError;
    removeOnConnect(callback: (ctx: DbConnectionImpl<RemoteModule>, ...args: any[]) => void): void;
    removeOnDisconnect(callback: (ctx: DbConnectionImpl<RemoteModule>, ...args: any[]) => void): void;
    removeOnConnectError(callback: (ctx: DbConnectionImpl<RemoteModule>, ...args: any[]) => void): void;
    onReducer(reducerName: string, callback: ReducerEventCallback<RemoteModule>): void;
    offReducer(reducerName: string, callback: ReducerEventCallback<RemoteModule>): void;
}
//# sourceMappingURL=db_connection_impl.d.ts.map