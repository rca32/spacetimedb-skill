DESIGN 대한 아래 질문에 대한 답변 작성 


1. 비전·스코프
“코지”의 구체 기준
세션 30–60분, D1 40%+ 리텐션 등은 정해져 있는데, “코지”를 수치로 정의할 계획이 있나요? (예: PvP 손실 상한, 실패 시 복구 비용, 스트레스 지표 등)
완전 솔로 “비목표”의 경계
“완전한 솔로 전용 성장”은 비목표라고 했을 때, 솔로 플레이로 얼마까지 성장 가능하게 할지(예: 레벨/콘텐츠 % 상한)를 정할 예정인가요?

2. 월드·좌표·청크
SpacetimeDB와 청크 스트리밍
청크 32×32, 3×3 관심 영역은 설계에 있는데, SpacetimeDB 구독/쿼리로 “현재 위치 기준 N청크만 구독”하는 패턴을 리전/샤드 단위와 어떻게 매핑할지 정했나요? (예: region_id + 청크 좌표 기반 구독 규칙)
다차원(인스턴스)과 리전
instance_id(던전/인테리어)는 region_id와 별도인데, 인스턴스 진입/퇴장 시 구독 전환(리전 ↔ 인스턴스)을 클라이언트/서버에서 어떤 이벤트로 처리할지 정해두었나요?
entity_core의 visibility
entity_core에 “visibility 플래그가 있으면 RLS”라고 되어 있는데, 스키마에는 visibility 필드가 없습니다. 추가 예정인가요, 아니면 다른 테이블(예: player_state 등)과 조인해 RLS를 적용할 계획인가요?

3. 전투·밸런스
AttackOutcome 보관 기간
attack_outcome은 공개·피해 기록용인데, TTL이나 보관 기간(예: 90일, 전투 종료 후 N분)을 정할 예정인가요? 로그 폭증·구독 비용을 막기 위함입니다.
위협(Threat) 초기화 시점
전투 종료(또는 타겟 사망) 시 threat_state를 즉시 삭제할지, 일정 시간 유지 후 삭제할지 정했나요? (재진입, 어그로 리셋 등)
밸런스 파라미터 버전/캐시
balance_params를 라이브 튜닝할 때, 클라이언트/다른 서비스가 이전 값 캐시를 쓰다가 불일치할 수 있습니다. 버전/스키마 버전이나 “파라미터 갱신 시 강제 리로드” 같은 규칙을 둘 계획인가요?

4. 경제·거래
market_order와 order_fill의 구독
마켓 오더북은 (item_def_id, price) 등으로 구독할 수 있는데, 체결 기록(order_fill)은 누가(글로벌 서비스 vs 월드 샤드) 쓰고, 클라이언트는 어떤 범위로 구독할지(본인 체결만 vs 풀 로그) 정했나요?
직접 거래 45초 타임아웃
타임아웃 시 이미 잠긴 아이템/코인은 자동 롤백으로만 처리할지, 부분 완료(한쪽만 수락) 같은 예외 플로우를 정의할 예정인가요?
NPC 가격 변동 5%·1회/일
이 제한은 NPC당인가요, 품목당인가요? 여러 NPC가 같은 품목을 팔 때 동기화(동시 변동 금지 등) 정책이 있나요?

5. LLM NPC
npc_id와 entity_id
npc_state의 npc_id가 곧 entity_core.entity_id와 동일한지, 아니면 NPC 전용 ID 체계를 쓸지 정했나요? (위치/전투/구독 쿼리와의 일관성)
대화 턴 상한·요약 주기
단기 기억 5–10턴이라고 했을 때, 턴 수 상한 도달 시 곧바로 요약해서 npc_memory_short에 넣고 세션은 유지할지, 세션을 끊고 새 세션으로 할지 정했나요?
LLM 퀘스트 생성 검증
“서버 규칙 검증 후 QuestChain/Stage 기록”이라고 했는데, 검증 실패 시 플레이어에게는 어떻게 보여줄지(무시 vs “NPC가 제안을 거절했습니다” 등) 정했나요?

6. 인증·권한·RLS
RLS의 “viewer” 주체
player_state 등 RLS 뷰에서 :viewer_identity, :viewer_entity_id를 쓰는데, SpacetimeDB에서 RLS를 identity/entity 기준으로 적용하는 방식(정책 함수, 뷰 필터 등)을 이미 정했나요? 문서에 “RLS 뷰”라고만 되어 있어서, 구현 수준의 선택지를 알고 싶습니다.
permission_state의 target_id/subject_id
target_id가 건물/클레임 등이고 subject_id가 플레이어/그룹일 때, 엠파이어/길드 단위 권한은 subject_id를 “그룹 ID”로 두는 방식으로 갈지, 아니면 멤버별 permission_state만 쓸지 정했나요?

7. 아키텍처·SpacetimeDB
World Shard와 SpacetimeDB 인스턴스
아키텍처상 “World Shards = 지역 단위”인데, SpacetimeDB는 리전(샤드)당 1 DB 인스턴스로 가정하는지, 1 DB에 여러 리전을 테이블로 구분할지 방향이 정해져 있나요?
Event/Command Bus와 SpacetimeDB
“World Shard ↔ Event/Command Bus”라고 했을 때, Bus는 SpacetimeDB 밖(Redis/Kafka 등)으로 두고, SpacetimeDB 리듀서가 메시지를 consume하는 구조를 상정하는지, 아니면 SpacetimeDB 내부 테이블/리듀서만으로 이벤트를 흉내 낼 계획인가요?
글로벌 서비스와 게임 모듈
경제/길드 등은 “Global Services”, 월드 시뮬은 “게임 모듈”로 나뉘는데, SpacetimeDB 상에서는 모듈 분리(게임 모듈 vs 글로벌 모듈)로 구현하고, 크로스 모듈 호출/테이블 참조 규칙을 정해두었나요?

8. 운영·테스트
LLM 플레이어 봇의 identity
초기 유저 부재 시 LLM 봇이 “최소 인구”를 채운다고 했을 때, 이 봇들은 일반 계정(identity)으로 생성해 player_state에 넣을지, 봇 전용 identity/플래그로 구분할지 정했나요? (감사/지표/비용 추적용)
회귀 5% 차단의 단위
“지표 악화 5% 이상 시 차단”에서, 기준 지표(리텐션, ARPDAU, TTK 등)와 비교 기준(이전 패치, 특정 날짜)을 문서에 명시할 예정인가요?

9. 용어·문서 일관성
AuctionListingState / ClosedListingState
용어 사전에는 AuctionListingState, ClosedListingState가 있는데, 데이터 모델에는 market_order, order_fill로 되어 있습니다. 문서에서 용어를 통일(테이블명 기준으로 정리 등)할 계획이 있나요?
엠파이어(Empire)
권한·클레임에서 “엠파이어”가 나오는데, 엠파이어 전용 테이블(예: guild_state와 유사한 empire_state)을 둘 예정인가요, 아니면 클레임/길드 조합으로만 표현할 예정인가요?
원하시면 특정 영역(예: 경제만, NPC만, SpacetimeDB 매핑만)을 골라서, 그 부분을 



1) 비전·스코프

“코지” 수치화: 현재 문서에는 정량 정의 없음. 정량화된 것은 세션 30–60분, D1 40%+ 등 KPI뿐입니다. “패배 비용 최소화/실패의 학습 전환” 같은 질적 기준만 존재합니다. (00-vision-usp.md, 03-balancing.md)
완전 솔로 성장 상한: “완전한 솔로 전용 성장”이 비목표로만 선언되어 있고, 레벨/콘텐츠 상한은 없음. (00-vision-usp.md, 01-gdd.md)
2) 월드·좌표·청크

청크 스트리밍 매핑: 32×32 청크, 3×3 AOI는 명시됨. 구독은 region/instance 기준 필터가 필수이고, 쿼리 예시는 region_id/instance_id 필터로 제시됨. “현재 위치 기준 N청크 구독”은 region_id + chunk_x/chunk_y 혹은 AOI 타일 리스트 방식으로 구현될 것으로 보이나, 명시 규칙은 아직 없음. (02-systems-design.md, 05-data-model.md, terrain_chunk.md)
인스턴스 전환 구독: entity_core.instance_id와 instance_state는 정의되어 있고, 구독은 region/instance 기준으로 하도록 되어 있습니다. 다만 “어떤 이벤트로 구독 전환”은 문서에 명시되어 있지 않음(예: player_state.region_id 혹은 entity_core.instance_id 변경 시). (05-data-model.md, entity_core.md, instance_state.md)
entity_core visibility: RLS 설명에 visibility 플래그가 있으나 스키마에 필드가 없습니다. 추가 필드 도입 또는 다른 테이블 조인 방식 중 하나를 정해야 합니다. (entity_core.md)
3) 전투·밸런스

AttackOutcome 보관 기간: TTL/보관 정책 미정. 일반 로그 보관 정책(채팅/LLM 90일, 거래/경제 180일, 감사 1년)은 있으나 전투 로그는 명시 없음. (05-data-model.md, attack_outcome.md)
Threat 초기화: threat_state 삭제 시점/TTL 없음. 전투 종료/타겟 사망 후 즉시 삭제인지, 지연 삭제인지 정해야 함. (threat_state.md)
balance_params 버전/캐시: updated_at, param_change_log, param_guardrail와 라이브 튜닝 가드레일은 존재. 세션 내 급변 방지 원칙도 있음. 다만 클라이언트 캐시 불일치 방지용 “버전/강제 리로드” 규칙은 명시되지 않음. (03-balancing.md, balance_params.md, param_change_log.md, 05-data-model.md)
4) 경제·거래

market_order/order_fill 구독: market_order는 공개(소유자 마스킹), order_fill은 private/self-view만. 즉 클라 구독 범위는 “본인 체결만”이 기본. 누가 order_fill을 기록(글로벌 vs 샤드)하는지는 명시 없음. (market_order.md, order_fill.md, 05-data-model.md)
직접 거래 45초 타임아웃: 타임아웃/로그아웃 시 잠금 해제 및 롤백만 정의. 부분 완료 플로우는 문서에 없음. (02-systems-design.md, 06-sync-anti-cheat.md, 12-economy-inflation.md)
NPC 가격 변동 5%/1회·일: “가격 변경 하루 1회, 5% 이내”는 정의. 범위가 NPC 단위인지 품목 단위인지, 여러 NPC 동기화 규칙은 미정. (07-llm-npc-design.md)
5) LLM NPC

npc_id vs entity_id: npc_state는 npc_id, entity_core는 entity_id이고 매핑 규칙이 문서에 없습니다. AOI/전투/구독 일관성을 위해 통합 ID 또는 매핑 테이블 결정을 권장. (npc_state.md, entity_core.md)
턴 상한/요약 주기: 단기 기억 5–10턴, 토큰 상한/세션 종료 시 요약 저장. 비용 문서에서는 8턴 이상 요약 트리거 명시. “요약 후 세션 유지 vs 새 세션 시작”은 명시되지 않음. (07-llm-npc-design.md, 08-llm-npc-cost-performance.md)
퀘스트 생성 검증 실패 UX: “확정 결과만 클라이언트 전송” 원칙과 안전 문서의 거절/안내 응답만 존재. 실패 시 UI 메시지 정책은 미정. (07-llm-npc-design.md, 09-llm-npc-safety-moderation.md)
6) 인증·권한·RLS

RLS “viewer” 주체: 각 테이블 RLS가 SQL 뷰에서 :viewer_identity, :viewer_entity_id, :is_admin을 사용하는 방식으로 설계됨. 정책 함수 등 다른 메커니즘은 문서화되어 있지 않음. (player_state.md, attack_outcome.md 등)
permission_state subject/target: 권한 그룹(플레이어/클레임/엠파이어/전체)은 정의되어 있으나 permission_state는 target_id/subject_id만 있고 그룹 타입 정의가 없음. 길드/엠파이어 단위를 subject_id로 둘지, 멤버별로 둘지 결정 필요. (02-systems-design.md, 18-terminology.md, permission_state.md)
7) 아키텍처·SpacetimeDB

World Shard ↔ SpacetimeDB 인스턴스: 지역 단위 샤딩은 정의되었으나 “리전당 1 DB 인스턴스 vs 1 DB에 여러 리전”은 미정. (04-server-architecture.md, 15-tech-stack-build.md)
Event/Command Bus: 아키텍처상 외부 Bus 존재 전제이며, 데이터 흐름 매핑에도 Bus를 통해 이벤트/커맨드 교환으로 표기됨. 구현(예: Redis/Kafka)은 미정. (04-server-architecture.md, 05-data-model.md)
글로벌 서비스 vs 게임 모듈: 용어/빌드 분리는 명시됨. 교차 호출/테이블 참조 규칙은 명문화되지 않았고, 현재는 버스/메시지 교환 방식이 암시됨. (18-terminology.md, 15-tech-stack-build.md, 05-data-model.md)
8) 운영·테스트

LLM 봇 identity: “봇 활동은 별도 플래그로 식별/로그 기록” + “IAM에서 봇 계정 분리”만 언급. 일반 identity에 플래그 vs 전용 identity 체계는 미정. (11-testing-evaluation.md, 04-server-architecture.md)
회귀 5% 차단 단위: “지표 악화 5% 이상 차단”만 있고 기준 지표/비교 기준(이전 패치, 7일 평균 등) 미정. KPI 목록은 라이브 운영 문서에 존재. (11-testing-evaluation.md, 03-balancing.md, 16-live-ops.md)
9) 용어·문서 일관성

AuctionListingState/ClosedListingState vs market_order/order_fill: 용어 사전은 Auction/Closed 용어를 쓰는데, 데이터 모델은 market_order/order_fill. 표준 용어 통일 필요. (18-terminology.md, 05-data-model.md)
엠파이어 테이블: 용어 사전에는 EmpireNodeState/SiegeState 등이 있으나 데이터 모델에 테이블이 없음. “클레임/길드 조합”인지, 별도 empire_state류를 둘지 미정. (18-terminology.md, 13-community-social.md, 05-data-model.md)