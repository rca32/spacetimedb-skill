---
work_item: define-sync-and-anti-cheat-contracts
intent: mmo-core-server-foundation
created: 2026-02-07T14:41:04Z
mode: validate
checkpoint_1: approved
---

# Design: 동기화/안티치트 계약 정의

## Summary

`DESIGN/06-sync-anti-cheat.md`를 기준으로 서버 권위 검증, 상태 동기화, 위반 탐지/제재 플로우를 reducer 계약으로 명확화한다.

## Scope

**In Scope:**
- 서버 권위 영역(이동, 전투 판정, 거래)과 클라이언트 예측 허용 범위 분리
- 입력 검증 규칙(쿨다운, 비용, 범위, 속도/가속, 충돌) 표준화
- 동기화 규칙(10-20Hz 스냅샷, 이벤트 즉시 푸시, 델타 전송, 구독 범위) 명시
- 위반 점수 누적 및 자동 제한 -> 검토 -> 영구 제재 전이 정의

**Out of Scope:**
- ML 기반 탐지 모델 구현
- 클라이언트 렌더/애니메이션 최적화
- 운영 대시보드 UI 설계

## Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| 권위 모델 | 이동/전투/거래는 서버 최종 판정 | 치트 우회 차단과 상태 일관성 확보 |
| 예측 범위 | 클라이언트는 이동/스킬 애니메이션만 예측 | 체감 반응성 유지 + 판정 보안 유지 |
| 동기화 주기 | 10-20Hz 스냅샷 + 중요 이벤트 즉시 푸시 | 대역폭과 체감 지연 균형 |
| 검증 타이밍 | reducer 진입 시 1차, 영향 시점(타격/완료) 2차 검증 | 지연/예약 액션 악용 차단 |
| 제재 파이프라인 | 점수 누적 기반 단계적 제재 | 오탐 리스크를 줄이고 운영 개입 지점 확보 |

## Data Models Affected

### Modifies
- **session_state**: 지연/활성 상태를 기반으로 고핑 입력 허용창 판정 규칙 연동
- **action_state**: 액션 진행률(예: 80~95% 완료 허용 구간) 검증 계약 반영
- **combat_state**: 공격 시작/예약/타격 2단계 검증 흐름 반영
- **moderation_flag**: 위반 점수 누적 및 제재 단계 전이 저장 정책 반영

## Technical Approach

### Architecture

```
Client Input
  -> reducer validation (cooldown/cost/range/speed/collision/rate-limit)
  -> schedule if delayed action required
  -> execute at authoritative server tick
  -> re-validate at impact/complete point
  -> state mutation + subscription delta push
  -> anomaly scoring + moderation escalation
```

### API Changes

- `move_player` 계열 reducer: timestamp monotonic, speed/accel/collision 검증 계약 추가
- `attack_start`/`attack_scheduled`/`attack_impact` 계열 reducer: 단계별 재검증 계약 고정
- `trade_*` 계열 reducer: 거래 세션 중 인벤토리 잠금/롤백 규칙 명시

## Dependencies

- `align-data-model-and-permissions`

## Affected Files

| File | Action | Purpose |
|------|--------|---------|
| `DESIGN/06-sync-anti-cheat.md` | refine | 동기화/검증/제재 규칙을 계약 형태로 고정 |
| `DESIGN/DETAIL/player-regeneration-system.md` | cross-check | scheduled reducer 권한 제한 규칙 정합성 검증 |
| `DESIGN/DETAIL/world-generation-system.md` | cross-check | 서버 권위/동기화 파라미터 충돌 여부 점검 |

## Security Considerations

- **Speed hack / teleport**: 이동 입력의 시간 단조 증가, 속도/가속 상한, 충돌 재검증 강제
- **Early completion exploit**: 액션 완료 허용 구간 외 조기 완료 차단
- **Trade duping**: 거래 중 포켓 잠금과 세션 종료 시 롤백 규칙 적용
- **Privileged reducer abuse**: scheduled/admin reducer는 server/admin 권한에서만 실행

## Integration Points

| System | Type | Purpose |
|--------|------|---------|
| Subscription engine | realtime sync | 델타 전송 및 관심영역 기반 동기화 |
| Scheduler | delayed execution | 예약 액션/타이머 기반 판정 |
| Moderation pipeline | security ops | 위반 누적/제재 자동화 |

## Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| 과도한 보정으로 체감 저하 | Medium | 고핑 허용창과 보정 빈도 상한을 파라미터화 |
| 오탐 제재 누적 | High | 자동 제한 후 수동 검토 단계 의무화 |
| 구독 범위 과대 설정 | Medium | 관심영역 필터와 필드 단위 델타 전송 강제 |

## Implementation Checklist

- [ ] 서버 권위/클라이언트 예측 경계를 reducer별로 매핑
- [ ] 이동/전투/거래 검증 체크리스트를 공통 규약으로 정의
- [ ] 고핑 허용창 및 보정 정책을 파라미터 항목으로 고정
- [ ] 위반 점수 누적/제재 단계 전이를 상태 모델에 반영
- [ ] 관련 DESIGN 문서 간 용어/수치/타이머 일관성 검토

---
*Generated by specs.md - fabriqa.ai FIRE Flow | Checkpoint 1 approved: 2026-02-07T14:41:04Z*
