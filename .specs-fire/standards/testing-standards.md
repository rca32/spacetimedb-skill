# Testing Standards

## Overview

설계 검증은 정적 문서 검토와 SpacetimeDB CLI 기반 통합 테스트를 함께 사용한다.

## Testing Framework

**Framework**: Rust tests + CLI integration checks
**Runner**: `cargo test` and `spacetime` CLI

## Test Types

| Type | Tool | Location | When to Use |
|------|------|----------|-------------|
| Unit | `cargo test` | `stitch-server/**/tests` | reducer 유틸/도메인 로직 검증 |
| Integration | `spacetime call/sql` | local runtime | 권한/동기화/경제/전투 흐름 검증 |
| Schema Contract | SQL assertions | local runtime | 테이블/인덱스/필드 일관성 검증 |

## Coverage Requirements

**Target**: 80%
**Enforcement**: CI gate (planned)

**Critical paths that MUST have coverage:**
- 권한 비트마스크 해석 및 접근 제어
- 이동/전투 검증 로직
- 재생/포만감/디버프 전이
- scheduled reducer 인증/권한

## Test Naming

**Pattern**: `test_<feature>_<behavior>`

**Examples**:
- `test_permission_flags_owner_overrides` - 소유자 권한 우선 검증
- `test_regen_passive_blocked_in_combat` - 전투 중 패시브 재생 차단 검증

## Test Structure

```rust
#[test]
fn test_feature_behavior() {
    // arrange
    // act
    // assert
}
```

## Mock Strategy

**Approach**: 가능한 실제 SpacetimeDB 로컬 런타임 사용

**Guidelines**:
- 권한/동기화는 mock보다 통합 테스트 우선
- 시간 기반 로직은 고정 timestamp 또는 서버 타이머 제어

## Test Data

**Strategy**: seed data + 최소 재현 데이터셋

**Guidelines**:
- 테스트 간 독립성 유지
- static data와 runtime state 분리

## Running Tests

```bash
# Run all tests
cargo test

# Run with coverage
cargo test

# Run specific test file
cargo test --test <name>

# Run in watch mode
cargo test
```

## CI/CD Integration

CI/CD integration not configured.

---
*Generated by specs.md - fabriqa.ai FIRE Flow*
