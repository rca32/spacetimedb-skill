# System Architecture

## Overview

The repository is a monorepo that hosts SpacetimeDB core sources, game server modules, and supporting examples and tools. Each module/crate owns its tables, reducers, agents, and services while following shared design documentation.

## System Context

Developers build and run SpacetimeDB modules locally or in self-hosted environments. DESIGN documents define the authoritative behavior for server-side logic.

### Context Diagram

```
[Developer] -> [Monorepo Sources] -> [SpacetimeDB Runtime]
```

### Users

- **Developers**: implement reducers, tables, agents, and services
- **Game Servers**: execute SpacetimeDB modules in runtime

### External Systems

- **None**: external dependencies vary per module and are defined locally

## Architecture Pattern

**Pattern**: Modular monorepo with event-driven reducers
**Rationale**: Clear separation between core runtime, game modules, and tooling.

## Component Architecture

### Components

#### SpacetimeDB Core

- **Purpose**: Core runtime, database engine, and SDKs
- **Responsibilities**: Execution, storage, APIs, tooling
- **Dependencies**: Rust ecosystem crates

#### Stitch Server

- **Purpose**: Game server module implementation
- **Responsibilities**: Tables, reducers, services, agents based on DESIGN/DETAIL
- **Dependencies**: SpacetimeDB runtime

#### Examples and Tools

- **Purpose**: Demonstrations, tooling, and documentation
- **Responsibilities**: Sample modules, scripts, and learning assets
- **Dependencies**: Local module stacks

### Component Diagram

```
[SpacetimeDB Core] <-- [Stitch Server]
           ^
           |
     [Examples/Tools]
```

## Data Flow

Reducers mutate tables, agents schedule periodic work, and subscriptions deliver state to clients. Design documents define invariants and constraints.

```
[Reducer] -> [Tables] -> [Subscriptions] -> [Clients]
```

## Technology Stack

| Layer | Technology | Purpose |
|-------|------------|---------|
| Runtime | Rust + SpacetimeDB | Server execution and data model |
| Data | SpacetimeDB tables | State storage |
| Tooling | cargo + npm | Builds and scripts |

## Non-Functional Requirements

### Performance

- **Reducer latency**: Defined per module design documents
- **Agent tick rate**: Defined per module design documents

### Security

- No secrets in source control
- Access control enforced in reducers where applicable

### Scalability

Scale by modularizing workloads and keeping reducers deterministic.

## Constraints

- DESIGN/DETAIL docs are the source of truth for server behavior
- SpacetimeDB-related work must follow the SpacetimeDB skill guidance

## Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Core runtime | SpacetimeDB | Unified database + reducer model |
| Primary language | Rust | Performance and safety for server logic |
| Repo structure | Monorepo | Shared tooling and coordinated design |

---
*Generated by specs.md - fabriqa.ai FIRE Flow*
