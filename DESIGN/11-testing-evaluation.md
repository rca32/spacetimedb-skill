# 테스트 및 평가

## 자동화 테스트
- 단위: 전투/경제 규칙 함수 테스트.
- 통합: 퀘스트/거래/파티 흐름.
- 부하: 동시 접속, NPC 대화 부하.

## 시나리오 테스트
- 퀘스트 흐름: 수락-진행-보상-후속 분기.
- 경제 루프: 자원 채집-제작-거래-소비.

## LLM NPC 평가
- 품질 지표: 해결률, 유용도, 일관성 점수.
- 안전 지표: 금칙 응답률, 신고율.

## 회귀 기준
- 통과/실패 규칙: 지표 악화 5% 이상 시 차단.
- 비교 기준: 배포 직전 7일 이동 평균 대비 하락률.
- 대상 지표: D1/D7 리텐션, ARPDAU, 평균 TTK, 경제 인플레 지수.

## 세부 설계 (BitCraft 참고)

### 핵심 단위 테스트
- 좌표 변환: Hex<->Offset 왕복, 거리/링 연산 정확도.
- 월드 생성: 시드 고정 시 동일 결과(지형/바이옴/자원) 재현.
- 인벤토리: pocket 용량/잠금, Item/Cargo 분기, merge 규칙.
- 전투: 공격 예약/타격 지연, 위협 누적, 스케일링 적용.

### 통합 시나리오
- 건축: project site -> 자재 투입 -> 진행 -> 완공 전환.
- 클레임: 타일 추가/삭제 인접성/연결성 검증.
- 거래: 직접 거래 포켓 잠금 + 타임아웃 롤백.
- 경매: 주문 매칭/escrow/환불(order_fill) 흐름.

### 부하/시뮬레이션
- 에이전트 동시 실행(regen/decay/npc ai/resource) 시 TPS/지연 확인.
- NPC 이동/주문 갱신 1만 동시 시뮬레이션.

## LLM/TUI 기반 평가 설계

### 목표
- AI가 텍스트(TUI)만으로 게임 상태를 파악하고 행동할 수 있도록 지원.
- LLM이 실제 플레이어처럼 게임을 수행해 자동 평가/로드 테스트에 활용.
- 초기 사용자 부재 시 LLM이 “가짜 플레이어” 역할을 수행해 경제/소셜/콘텐츠 활성화.

### TUI 접근 레이어
- 상태 조회: 플레이어 위치/인벤토리/퀘스트/거래/클레임/시간을 텍스트로 요약 제공.
- 액션 수행: 이동/채집/제작/거래/대화/건축을 TUI 명령으로 실행.
- 제한: 모든 액션은 기존 reducer 경로로만 수행(서버 권위 유지).
- 포맷: 구조화된 텍스트(키-값/표 형식)로 LLM이 파싱 가능하게 설계.
- 실행 방식: Toolcalling 기반으로 상태 조회/액션 실행을 분리.

### LLM 플레이어 시뮬레이터
- 역할: 탐험가/제작가/상인/건축가/길드원 등 역할 기반 에이전트 프로필 제공.
- 목표: 경제 순환, 퀘스트 소모, 거래 활성화, 클레임 유지.
- 제약: 동일 플레이어처럼 스태미나/내구도/재화 제한 준수.
- 행동 계획: “상태 조회 → 목표 선택 → 액션 실행 → 결과 반영” 루프.

### 평가 지표
- 진행률: 목표 달성률(퀘스트 완료, 제작/거래 성공률).
- 경제 지표: NPC/플레이어 거래 체결률, 코인 순환 속도.
- 안정성: 에러/거절/쿨다운 위반율, 액션 실패율.
- 성능: 응답 지연, 서버 TPS, 에이전트 동시성 처리.

### 초기 사용자 부재 대응
- LLM 봇 풀을 최소 인구로 유지(리전당 N명).
- 루틴: 시장 주문 생성/취소, 자원 채집/판매, 커뮤니티 이벤트 참여.
- 정책: 실제 유저 유입 시 봇 비율 자동 감소.

### 안전/운영 가드레일
- 봇 활동은 별도 플래그로 식별/로그 기록.
- 실험 모드에서만 활성화 가능하도록 환경 플래그 적용.
- 과도한 시장 왜곡 방지를 위한 거래 상한/쿨다운 적용.
