# 동기화 및 치트 방지

## 권한 모델
- 서버 권위 범위: 이동, 전투 판정, 거래는 서버 권위.
- 클라이언트 예측: 이동/스킬 애니메이션만 예측.

## 상태 동기화
- 스냅샷 주기: 10-20Hz, 중요 이벤트는 즉시 푸시.
- 델타 압축: 관심 영역 기반, 변경 필드만 전송.
- 구독 모델: 테이블 구독 기반으로 변경분 자동 전파.

## 검증
- 입력 검증 규칙: 스킬 쿨다운, 자원 비용, 범위 체크.
- 이동 체크: 속도/가속 제한, 장애물 충돌 검사.
- 고핑 처리: 허용 지연창 내 입력만 수용, 초과 시 서버 위치로 보정.

## 치트 방지 수단
- 행동 분석: 비정상 DPS, 자원 생성, 이동 패턴 탐지.
- 레이트 리미팅: 액션/채팅/거래 빈도 제한.
- 서버 스케줄러: 지연/예약 액션은 서버 타이머로 처리.

## 보안 대응
- 플래그 기준: 위반 점수 누적, 반복 이상 징후.
- 제재 프로세스: 자동 제한 -> 검토 -> 영구 제재.

## 세부 설계 (BitCraft 참고)

### 이동/행동 검증 강화
- 이동: 타임스탬프 단조 증가, 최대 속도/가속, 고도 차(예: 6 이상) 차단, 풋프린트/충돌 검사.
- 달리기: cargo 보유 시 러닝 금지, 스태미나 부족 시 자동 걷기 전환.
- 행동 타이밍: 액션 진행률 80~95% 구간에서 서버가 완료 허용(조기 완료 방지).
- 재조정: 반복 위반 시 서버 위치 기준으로 강제 리컨실리에이션.

### 전투 타이밍
- 공격은 2단계(시작 -> 예약 타이머 -> 타격)로 처리해 지연/투사체 검증.
- 타격 시점에 거리/타겟/쿨다운 재검증.

### 거래 안전
- 직접 거래 시 인벤토리 포켓 잠금으로 이동/소비 차단.
- 세션 타임아웃/로그아웃 시 잠금 해제 및 롤백.

### 에이전트 보안
- scheduled reducer는 server/admin 권한 검증 후 실행.
- agents_enabled 플래그로 점검/비상 정지 지원.

### 개발 모드
- dev 환경에서 인증/권한 우회 가능(운영 환경에서는 반드시 비활성).
