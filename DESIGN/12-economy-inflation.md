# 경제 및 인플레이션 제어

## 통화 설계
- 기본 통화: 코인.
- 프리미엄 통화: 코스메틱 토큰.
- 지갑: 인벤토리 인덱스 분리(지갑 전용 슬롯)로 코인 이동/잠금 관리.
- 코인 플로우: 거래/퀘스트/세금/유지비가 모두 코인 기반으로 수렴.

## 소스/싱크
- 소스
  - 퀘스트/업적 보상.
  - 플레이어 거래 수익(경매/바터/직접 거래).
  - 이벤트 보상, NPC 거래 보상.
- 싱크
  - 수리비/내구도 교체.
  - 제작 소모품 및 촉매.
  - 클레임 유지비/세금/거점 운영 비용.
  - 시장 수수료(등록/체결), 거래 실패 비용.
- 싱크/소스 비율 목표: 주간 기준 55/45 유지.

## 인플레이션 제어
- 동적 세금: 과열 품목 거래세 상승.
- 가격 상한: 초반 핵심 재료는 상한 적용.
- 공급 완충: 자원 재생/성장 주기를 조절해 공급 과잉 방지.
- 비용 스케일: 고티어 제작/업그레이드에 비선형 비용 부여.
- 리워드 클램프: 이벤트 보상 상한 + 일일/주간 캡.

## 시장 건강 지표
- 유통 속도: 일일 거래 회전율.
- 가격 지수: 핵심 품목 바스켓 지수.
- 주문장 깊이: 상위 N단 가격대 유동성.
- 스프레드: 매수/매도 평균 스프레드.
- 코인 집중도: 상위 1%/5% 보유 비율.
- NPC 거래 비중: NPC vs 플레이어 거래 체결 비율.

## 거래 구조
- 직접 거래: 세션 기반 교환과 아이템 잠금.
- 경매형 주문: 매수/매도 주문과 체결 기록.
- 상점형 주문: 바터 스톨 기반의 고정 교환.

## 거래 흐름
- 직접 거래: 초대 -> 수락 -> 아이템 잠금 -> 최종 교환.
- 매도 주문: 아이템 예치 -> 주문 매칭 -> 정산 기록.
- 매수 주문: 코인 예치 -> 가격 우선 매칭 -> 환급.

## 수수료/세율(초안)
- 주문 등록 수수료: 2%.
- 거래 체결 수수료: 5%.
- 바터 스톨 유지비: 일일 1%.

## 세부 설계 (BitCraft 참고)

### 경제 루프
- 채집 -> 정제/가공 -> 제작 -> 건축/업그레이드 -> 유지비 지출.
- 거래는 인벤토리 잠금과 escrow로 안전성 확보.
- 클레임 유지비가 장기적 싱크로 작동.

### 직접 거래 세션
- TradeSessionState로 세션 관리, 양측 인벤토리 포켓 잠금.
- 타임아웃/로그아웃 시 잠금 해제 및 세션 종료.
- 완료 시 Discovery 갱신과 인벤토리 용량 재검증.
- 거리 제한: 직접 거래 6타일 기준.
- 세션 만료: 45초 기본.

### 주문장(경매형)
- buy/sell 테이블 분리, 가격 우선 + 시간 우선 매칭.
- buy 주문은 escrow 코인 보관, 체결 가격 차액은 환불 기록.
- 취소 시 잔여 물량/코인 ClosedListing으로 회수.
- 체결 기록은 ClosedListingState로 수령(수령 시 인벤토리 공간 재검증).
- 부분 체결 허용, 남은 수량은 오더북에 유지.
- 동일 가격 내에서는 오래된 주문 우선.

### 바터 스톨(상점형)
- TradeOrderState로 다중 아이템 교환 지원.
- 시장 모드 시 한쪽은 통화 전용(가격 명확성 확보).
- 재고/횟수 제한으로 공급 과잉 방지.
- 거리 제한: 바터 스톨 5타일 기준.

### NPC 거래/주문
- 여행형 NPC는 이동 시 거래 주문 재생성, 고정형은 주기 갱신.
- always_offered + 랜덤 선택 조합으로 공급 다양성 유지.
- 파라미터 `selected_traveler_order_count`로 선택 폭 제어.

### 인벤토리/잠금/에스크로
- 직접 거래: 포켓 잠금으로 아이템 이동/소비 차단.
- 경매: buy 주문 코인은 escrow 보관, sell 주문 아이템은 예치.
- 실패/취소 시 ClosedListing으로 환불/반환 후 수령 처리.

### 가격/세금 정책
- 동적 세금 트리거: 가격 급등·체결량 급증 품목에 추가 세율.
- 거래 수수료는 품목/카테고리별 가중치 적용 가능.
- 초반 핵심 재료는 상한 + 일시적 수급 보조로 안정화.

### 악용 방지
- 반복 거래/자전 거래 패턴 탐지, 이상 거래 플래그.
- 거래 요청/주문 생성 레이트 리미팅.
- 인벤토리 용량 부족 시 체결/수령 실패 처리.

### 운영 파라미터
- 수수료/세율/유지비는 파라미터 테이블로 핫픽스 가능.
- 이벤트 보상/드랍률은 주간 가드레일(변경폭 제한) 적용.
