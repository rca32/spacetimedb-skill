# LLM/VLM NPC 안전 및 중재

## 안전 목표
- 유해 발화 최소화와 세계관 일관성 유지.

## 콘텐츠 정책
- 금지 콘텐츠: 혐오, 폭력 조장, 불법 행위.
- 민감 주제: 정치, 종교, 실존 인물 추측.
- 세계관 일탈: 시스템/운영/내부 정보 공개 금지.
- 경제 악용: 시세 조작/무한 보상 유도 차단.

## 가드레일
- 프롬프트 규칙: 메타 발화 금지, 권한 범위 고정.
- 출력 필터: 금칙어 필터 + 안전 분류.
- 스키마 검증: 액션 요청은 구조 검증 실패 시 폐기.
- 화이트리스트: 허용된 액션 타입만 실행.

## 악용 대응
- 스팸 제한: 대화 빈도 제한, 반복 요구 차단.
- 플레이어 신고 흐름: 신고 -> 큐 -> 운영 검토.
- 피드백 루프: 신고/차단 데이터를 안전 모델에 반영.

## 사고 대응
- 에스컬레이션 단계: 자동 차단 -> 운영 경보 -> 수정 배포.
- 롤백 계획: 모델 버전 롤백과 안전 모드 전환.
- 안전 모드: NPC는 안내/거절 응답만 제공.

## 서버 제어 지점
- 대화 리듀서에서 정책 검증.
- 로그 테이블에 위반 플래그 기록.
- 위험도 기준으로 응답 차단/완화.
- 서버 권한 검증(ServerIdentity)과 분리된 LLM 권한.

## 세부 설계 (BitCraft 참고)

### 서버 권위 강제
- LLM 출력은 직접 상태 변경 금지, 반드시 reducer/핸들러를 통해 검증.
- 에이전트/관리자 권한 검증 패스와 분리(LLM은 권한 없음).

### 경제/거래 가드레일
- 가격/주문 변경은 서버가 상한/쿨다운 검증 후 반영.
- trade_order 생성은 항상 정적 데이터/허용 목록 기반으로 제한.
- NPC 주문 생성은 always_offered/선택형 풀에서만 허용.

### 행동 범위 제한
- 허용 행동: 대화, 퀘스트 제안, 합법적 거래 제안, 안내/경고.
- 금지 행동: 권한 상승, 공급/통화 무한 생성, 클레임 권한 변경.
- 퀘스트 보상은 서버가 상한/레벨/진행도 검증 후 확정.

### 악용 시나리오 대응
- 프롬프트 인젝션: 시스템/정책 메시지 분리 + 입력 정규화.
- 권한 위임 요청: 명시적으로 거절, 운영 채널 안내.
- 경제 조작 시도: 가격/수요 발화는 안내로 제한.

### 테스트/검증
- 금칙/민감 주제 샘플셋으로 회귀 테스트.
- 정책 위반 시 자동 차단율/오탐률 모니터링.
